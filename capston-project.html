<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dbt E-commerce Analytics Lab Guide</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        :root {
            --bs-primary: #6f42c1; /* Purple */
            --bs-primary-rgb: 111, 66, 193;
            --bs-primary-light: #f4f0ff;
            --bs-secondary: #0d6efd; /* Blue */
            --bs-body-bg: #fafbff;
            --bs-dark-purple: #301934;
        }

        body {
            background-color: var(--bs-body-bg);
        }

        .hero-header {
            background: linear-gradient(135deg, var(--bs-primary), var(--bs-secondary));
            color: white;
            padding: 4rem 2rem;
            margin-bottom: 3rem;
            border-radius: 0.5rem;
        }

        .cite {
            font-size: 0.75em;
            font-weight: bold;
            color: var(--bs-primary);
            opacity: 0.7;
            padding-left: 4px;
        }

        /* Tabs Styling */
        .nav-tabs .nav-link {
            color: var(--bs-secondary);
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            color: var(--bs-primary);
            border-color: var(--bs-primary) var(--bs-primary) #fff;
            border-bottom-width: 3px;
        }
        .tab-content {
            border: 1px solid #dee2e6;
            border-top: 0;
            padding: 2rem;
            background-color: #fff;
            border-radius: 0 0 0.375rem 0.375rem;
        }

        /* Accordion Styling */
        .accordion-button {
            font-weight: 500;
        }
        .accordion-button:not(.collapsed) {
            background-color: var(--bs-primary-light);
            color: var(--bs-primary);
            box-shadow: none;
        }
        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25);
        }

        /* Code Block Styling */
        .code-block {
            background-color: var(--bs-dark-purple);
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        .code-block pre {
            margin: 0;
        }
        .code-block .comment {
            color: #9a9a9a;
        }
        .code-block .yaml-key {
            color: #66d9ef; /* Light Blue */
        }
        .code-block .yaml-string {
            color: #e6db74; /* Yellow */
        }
        .code-block .sql-keyword {
            color: #f92672; /* Pink/Red */
        }
        .code-block .sql-function {
            color: #a6e22e; /* Green */
        }

        /* Custom Alert */
        .alert-primary {
            background-color: var(--bs-primary-light);
            border-color: rgba(var(--bs-primary-rgb), 0.3);
            color: var(--bs-primary);
        }
        .alert-primary .alert-heading {
            color: inherit;
        }
        
        .explanation {
            background-color: #fdfdff;
            border-left: 4px solid var(--bs-secondary);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="hero-header text-center">
            <h1 class="display-4">Comprehensive dbt Project Lab</h1>
            <p class="lead">A Hands-On Guide to E-Commerce Data Transformation</p>
        </div>
    </div>

    <div class="container mb-5">
        
        <h2 class="mb-3"><i class="bi bi-bullseye" style="color: var(--bs-primary);"></i> Project Overview</h2>
        
        <div class="alert alert-primary" role="alert">
            <h4 class="alert-heading">Project Goal</h4>
            <p>Transform raw e-commerce data (customers, orders, payments) into a clean, aggregated format for analytics and reporting. [cite_start]<span class="cite">[cite: 2]</span></p>
        </div>

        <div class="accordion mb-4" id="featuresAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#features-collapse" aria-expanded="false" aria-controls="features-collapse">
                        <i class="bi bi-card-checklist me-2"></i><strong>Features Covered in this Lab</strong>
                    </button>
                </h2>
                <div id="features-collapse" class="accordion-collapse collapse" data-bs-parent="#featuresAccordion">
                    <div class="accordion-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><strong>Project Configuration (dbt_project.yml):</strong> Profile config, vars, materializations, schemas, tags, hooks. [cite_start]<span class="cite">[cite: 4-10]</span></li>
                            <li class="list-group-item"><strong>Packages (packages.yml):</strong> Integration of dbt_utils and dbt_expectations. [cite_start]<span class="cite">[cite: 11-13]</span></li>
                            <li class="list-group-item"><strong>Seeds (data/):</strong> Loading static data (e.g., `product_categories.csv`). [cite_start]<span class="cite">[cite: 14-16]</span></li>
                            <li class="list-group-item"><strong>Macros (macros/):</strong> Utility macros and custom generic tests. [cite_start]<span class="cite">[cite: 17-20]</span></li>
                            <li class="list-group-item"><strong>Sources (models/sources.yml):</strong> Defining raw tables, descriptions, and freshness checks. [cite_start]<span class="cite">[cite: 21-24]</span></li>
                            <li class="list-group-item"><strong>Multi-Layered Models:</strong>
                                <ul>
                                    <li><strong>Staging:</strong> Light transformations, renaming, source referencing. [cite_start]<span class="cite">[cite: 26-32]</span></li>
                                    <li><strong>Intermediate:</strong> Joins, complex logic, ephemeral materialization. [cite_start]<span class="cite">[cite: 33-40]</span></li>
                                    <li><strong>Marts:</strong> Final dimension/fact tables, advanced tests, tags. [cite_start]<span class="cite">[cite: 41-50]</span></li>
                                </ul>
                            </li>
                            <li class="list-group-item"><strong>Exposures (models/exposures.yml):</strong> Documenting dashboards and ML models. [cite_start]<span class="cite">[cite: 51-54]</span></li>
                            <li class="list-group-item"><strong>Metrics (models/metrics.yml):</strong> Defining business metrics within dbt. [cite_start]<span class="cite">[cite: 55-58]</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>


        <ul class="nav nav-tabs" id="labTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="setup-tab" data-bs-toggle="tab" data-bs-target="#setup-tab-pane" type="button" role="tab" aria-controls="setup-tab-pane" aria-selected="true">
                    <i class="bi bi-tools me-1"></i> 1. Setup & Execution
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="files-tab" data-bs-toggle="tab" data-bs-target="#files-tab-pane" type="button" role="tab" aria-controls="files-tab-pane" aria-selected="false">
                    <i class="bi bi-files me-1"></i> 2. Project Files & Code
                </button>
            </li>
        </ul>

        <div class="tab-content" id="labTabsContent">
            
            <div class="tab-pane fade show active" id="setup-tab-pane" role="tabpanel" aria-labelledby="setup-tab" tabindex="0">
                [cite_start]<h3 class="mb-3">Project Setup Instructions <span class="cite">[cite: 59]</span></h3>
                <p>Follow these steps to set up the dbt project and run it. [cite_start]<span class="cite">[cite: 61]</span> (We recommend using dbt Core and Snowflake). [cite_start]<span class="cite">[cite: 60]</span></p>

                <div class="list-group">
                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">1. Create Your Project Directory</h5>
                            <span class="badge bg-primary rounded-pill">Step 1</span>
                        </div>
                        <p class="mb-1">Create an empty folder on your system (e.g., <code>ecom_analytics</code>). This will be your dbt project root. [cite_start]<span class="cite">[cite: 62, 63]</span></p>
                    </div>

                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">2. Create Files and Paste Code</h5>
                            <span class="badge bg-primary rounded-pill">Step 2</span>
                        </div>
                        <p class="mb-1">Inside <code>ecom_analytics/</code>, create the exact directory structure and files shown in the <strong>"Project Files & Code"</strong> tab. [cite_start]<span class="cite">[cite: 65]</span></p>
                        <p class="mb-1">Copy and paste the code provided for each file into its corresponding location. [cite_start]<span class="cite">[cite: 66]</span></p>
                    </div>

                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">3. Prepare Your Data Warehouse</h5>
                            <span class="badge bg-primary rounded-pill">Step 3</span>
                        </div>
                        <p class="mb-1">Create the dummy raw tables in your data warehouse that match the <code>sources.yml</code> definitions. [cite_start]<span class="cite">[cite: 68]</span></p>
                        <div class="alert alert-warning mt-2">
                            <strong>Crucially:</strong> Replace <code>your_database.your_schema</code> with your actual database and schema names in all SQL statements. [cite_start]<span class="cite">[cite: 69]</span> This must match your <code>sources.yml</code> file. [cite_start]<span class="cite">[cite: 70]</span>
                        </div>
                        
                        <div class="accordion accordion-flush mt-3" id="sqlAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sql-1" aria-expanded="false" aria-controls="sql-1">
                                        <i class="bi bi-person-lines-fill me-2"></i> DDL & Sample Data for <code>raw_customers</code>
                                    </button>
                                </h2>
                                <div id="sql-1" class="accordion-collapse collapse" data-bs-parent="#sqlAccordion">
                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- DDL for raw_customers</span> <span class="cite">[cite: 72]</span>
<span class="sql-keyword">CREATE OR REPLACE TABLE</span> your_database.your_schema.raw_customers (
    [cite_start]customer_id <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">PRIMARY KEY</span>, <span class="cite">[cite: 73]</span>
    [cite_start]first_name <span class="sql-keyword">VARCHAR</span>(100), <span class="cite">[cite: 75]</span>
    [cite_start]last_name <span class="sql-keyword">VARCHAR</span>(100), <span class="cite">[cite: 76]</span>
    [cite_start]email <span class="sql-keyword">VARCHAR</span>(100), <span class="cite">[cite: 77]</span>
    [cite_start]registration_date <span class="sql-keyword">DATE</span>, <span class="cite">[cite: 78]</span>
    [cite_start]updated_at <span class="sql-keyword">TIMESTAMP_NTZ</span> <span class="cite">[cite: 79]</span>
);

[cite_start]<span class="comment">-- Sample Data for raw_customers</span> <span class="cite">[cite: 80]</span>
[cite_start]<span class="sql-keyword">INSERT INTO</span> your_database.your_schema.raw_customers (customer_id, first_name, last_name, email, registration_date, updated_at) <span class="sql-keyword">VALUES</span> <span class="cite">[cite: 81]</span>
('cust_001', 'Alice', 'Smith', 'alice@example.com', '2023-01-15', '2023-01-15 10:00:00'),
('cust_002', 'Bob', 'Johnson', 'bob@example.com', '2023-02-20', '2023-02-20 11:30:00'),
('cust_003', 'Charlie', 'Brown', 'charlie@example.com', '2023-03-01', '2023-03-01 14:00:00'); [cite_start]<span class="cite">[cite: 82]</span>
</code></pre></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sql-2" aria-expanded="false" aria-controls="sql-2">
                                        <i class="bi bi-cart3 me-2"></i> DDL & Sample Data for <code>raw_orders</code>
                                    </button>
                                </h2>
                                <div id="sql-2" class="accordion-collapse collapse" data-bs-parent="#sqlAccordion">
                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- DDL for raw_orders</span> <span class="cite">[cite: 83]</span>
<span class="sql-keyword">CREATE OR REPLACE TABLE</span> your_database.your_schema.raw_orders (
    [cite_start]order_id <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">PRIMARY KEY</span>, <span class="cite">[cite: 85]</span>
    [cite_start]customer_id <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span>, <span class="cite">[cite: 86]</span>
    [cite_start]order_date <span class="sql-keyword">DATE NOT NULL</span>, <span class="cite">[cite: 87]</span>
    [cite_start]order_status <span class="sql-keyword">VARCHAR</span>(50), <span class="cite">[cite: 88]</span>
    [cite_start]amount <span class="sql-keyword">NUMERIC</span>(10, 2) <span class="cite">[cite: 89]</span>
);

[cite_start]<span class="comment">-- Sample Data for raw_orders</span> <span class="cite">[cite: 91]</span>
[cite_start]<span class="sql-keyword">INSERT INTO</span> your_database.your_schema.raw_orders (order_id, customer_id, order_date, order_status, amount) <span class="sql-keyword">VALUES</span> <span class="cite">[cite: 92]</span>
('ord_101', 'cust_001', '2023-01-16', 'completed', 75.00)[cite_start], <span class="cite">[cite: 93]</span>
('ord_102', 'cust_001', '2023-03-01', 'pending', 120.00)[cite_start], <span class="cite">[cite: 94]</span>
('ord_103', 'cust_002', '2023-02-25', 'completed', 50.00)[cite_start], <span class="cite">[cite: 95]</span>
('ord_104', 'cust_003', '2023-03-05', 'completed', 200.00); [cite_start]<span class="cite">[cite: 96]</span>
</code></pre></div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sql-3" aria-expanded="false" aria-controls="sql-3">
                                        <i class="bi bi-credit-card me-2"></i> DDL & Sample Data for <code>raw_payments</code>
                                    </button>
                                </h2>
                                <div id="sql-3" class="accordion-collapse collapse" data-bs-parent="#sqlAccordion">
                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- DDL for raw_payments</span> <span class="cite">[cite: 97]</span>
<span class="sql-keyword">CREATE OR REPLACE TABLE</span> your_database.your_schema.raw_payments (
    [cite_start]payment_id <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">PRIMARY KEY</span>, <span class="cite">[cite: 100]</span>
    [cite_start]order_id <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span>, <span class="cite">[cite: 101]</span>
    [cite_start]payment_method <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span>, <span class="cite">[cite: 102]</span>
    [cite_start]amount <span class="sql-keyword">NUMERIC</span> (10, 2) <span class="sql-keyword">NOT NULL</span>, <span class="cite">[cite: 103]</span>
    [cite_start]payment_date <span class="sql-keyword">DATE NOT NULL</span>, <span class="cite">[cite: 104]</span>
    [cite_start]status <span class="sql-keyword">VARCHAR</span>(20) <span class="cite">[cite: 105]</span>
);

[cite_start]<span class="comment">-- Sample Data for raw_payments</span> <span class="cite">[cite: 106]</span>
[cite_start]<span class="sql-keyword">INSERT INTO</span> your_database.your_schema.raw_payments (payment_id, order_id, payment_method, amount, payment_date, status) <span class="sql-keyword">VALUES</span> <span class="cite">[cite: 107]</span>
('pay_001', 'ord_101', 'credit_card', 50.00, '2023-01-16', 'completed')[cite_start], <span class="cite">[cite: 108]</span>
('pay_002', 'ord_101', 'bank_transfer', 25.00, '2023-01-16', 'completed')[cite_start], <span class="cite">[cite: 109]</span>
('pay_003', 'ord_102', 'credit_card', 70.00, '2023-03-01', 'pending')[cite_start], <span class="cite">[cite: 109]</span>
('pay_004', 'ord_102', 'gift_card', 50.00, '2023-03-01', 'pending')[cite_start], <span class="cite">[cite: 110]</span>
('pay_005', 'ord_103', 'bank_transfer', 50.00, '2023-02-25', 'completed')[cite_start], <span class="cite">[cite: 111]</span>
('pay_006', 'ord_104', 'credit_card', 150.00, '2023-03-05', 'completed')[cite_start], <span class="cite">[cite: 112]</span>
('pay_007', 'ord_104', 'gift_card', 50.00, '2023-03-05', 'completed'); [cite_start]<span class="cite">[cite: 113]</span>
</code></pre></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">4. Configure <code>profiles.yml</code> (dbt Core Users)</h5>
                            <span class="badge bg-primary rounded-pill">Step 4</span>
                        </div>
                        <p class="mb-1">If running dbt Core locally, set up your <code>~/.dbt/profiles.yml</code> file. [cite_start]<span class="cite">[cite: 115, 116]</span></p>
                        [cite_start]<p class="mb-1">Add a profile named <code>ecom_analytics</code> that points to your data warehouse: <span class="cite">[cite: 117, 119]</span></p>
                        <p class="mb-1"><small><strong>dbt Cloud Users:</strong> You can skip this, as your connection is set up in the dbt Cloud UI. [cite_start]<span class="cite">[cite: 137]</span></small></p>
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="comment"># ~/.dbt/profiles.yml</span> <span class="cite">[cite: 118]</span>
[cite_start]<span class="yaml-key">ecom_analytics:</span> <span class="cite">[cite: 119]</span>
  [cite_start]<span class="yaml-key">target:</span> <span class="yaml-string">dev</span> <span class="cite">[cite: 120]</span>
  [cite_start]<span class="yaml-key">outputs:</span> <span class="cite">[cite: 121]</span>
    [cite_start]<span class="yaml-key">dev:</span> <span class="cite">[cite: 122]</span>
      [cite_start]<span class="yaml-key">type:</span> <span class="yaml-string">[your_warehouse_type_e.g._snowflake]</span> <span class="cite">[cite: 123]</span>
      [cite_start]<span class="yaml-key">account:</span> <span class="yaml-string">[your_account_id]</span> <span class="cite">[cite: 124]</span>
      [cite_start]<span class="yaml-key">user:</span> <span class="yaml-string">[your_user]</span> <span class="cite">[cite: 125]</span>
      [cite_start]<span class="yaml-key">password:</span> <span class="yaml-string">[your_password]</span> <span class="cite">[cite: 126]</span>
      [cite_start]<span class="yaml-key">role:</span> <span class="yaml-string">[your_role]</span> <span class="cite">[cite: 127]</span>
      [cite_start]<span class="yaml-key">warehouse:</span> <span class="yaml-string">[your_warehouse]</span> <span class="cite">[cite: 128]</span>
      [cite_start]<span class="yaml-key">database:</span> <span class="yaml-string">[your_database]</span> <span class="cite">[cite: 129]</span>
      [cite_start]<span class="yaml-key">schema:</span> <span class="yaml-string">[your_dev_schema]</span> <span class="comment"># This should be a schema for development</span> <span class="cite">[cite: 130]</span>
      [cite_start]<span class="yaml-key">threads:</span> <span class="yaml-string">4</span> <span class="cite">[cite: 130]</span>
</code></pre></div>
                    </div>

                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">5. Run dbt Commands</h5>
                            <span class="badge bg-primary rounded-pill">Step 5</span>
                        </div>
                        <p class="mb-1">Open your dbt Cloud IDE or local terminal navigated to the <code>ecom_analytics</code> directory. [cite_start]<span class="cite">[cite: 140, 141]</span></p>
                        [cite_start]<p class="mb-1">Run the following commands in sequence: <span class="cite">[cite: 142]</span></p>
<div class="code-block"><pre><code class="language-bash"><span class="comment"># Install packages (dbt_utils, dbt_expectations)</span>
[cite_start]<span class="sql-function">dbt</span> deps <span class="cite">[cite: 144]</span>

<span class="comment"># Load static data (product_categories.csv)</span>
[cite_start]<span class="sql-function">dbt</span> seed <span class="cite">[cite: 146]</span>

<span class="comment"># Build all models, run tests, and generate docs</span>
[cite_start]<span class="sql-function">dbt</span> build <span class="cite">[cite: 148]</span>

<span class="comment"># Serve the documentation</span>
[cite_start]<span class="sql-function">dbt</span> docs serve <span class="cite">[cite: 150]</span>
</code></pre></div>
                    </div>

                    <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">6. Explore the Documentation</h5>
                            <span class="badge bg-primary rounded-pill">Step 6</span>
                        </div>
                        <p class="mb-1">Open the URL provided by <code>dbt docs serve</code> in your browser (dbt Cloud will provide a link). [cite_start]<span class="cite">[cite: 152]</span></p>
                        <p class="mb-1">Explore the DAG, model pages, source pages, metrics, and exposures. Pay attention to the descriptions, tests, and tags you've added. [cite_start]<span class="cite">[cite: 154]</span></p>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="files-tab-pane" role="tabpanel" aria-labelledby="files-tab" tabindex="0">
                [cite_start]<h3 class="mb-3">Project Files and Code <span class="cite">[cite: 155]</span></h3>
                <p>Create the following directory structure and files within your <code>ecom_analytics</code> root folder.</p>

                <div class="accordion" id="projectFilesAccordion">
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#file-1" aria-expanded="true" aria-controls="file-1">
                                <i class="bi bi-filetype-yml me-2"></i> <strong><code>dbt_project.yml</code></strong> (Project Root)
                            </button>
                        </h2>
                        <div id="file-1" class="accordion-collapse collapse show" data-bs-parent="#projectFilesAccordion">
                            <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="comment"># dbt_project.yml</span> <span class="cite">[cite: 158]</span>
[cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">'ecom_analytics'</span> <span class="cite">[cite: 159]</span>
[cite_start]<span class="yaml-key">version:</span> <span class="yaml-string">'1.0.0'</span> <span class="cite">[cite: 160]</span>
[cite_start]<span class="yaml-key">config-version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 161]</span>

[cite_start]<span class="comment"># Profile name must match ~/.dbt/profiles.yml or dbt Cloud connection.</span> <span class="cite">[cite: 162, 163]</span>
[cite_start]<span class="yaml-key">profile:</span> <span class="yaml-string">'ecom_analytics'</span> <span class="cite">[cite: 164]</span>

[cite_start]<span class="yaml-key">model-paths:</span> [<span class="yaml-string">"models"</span>] <span class="cite">[cite: 165]</span>
[cite_start]<span class="yaml-key">seed-paths:</span> [<span class="yaml-string">"data"</span>] <span class="cite">[cite: 166]</span>
[cite_start]<span class="yaml-key">snapshot-paths:</span> [<span class="yaml-string">"snapshots"</span>] <span class="cite">[cite: 167]</span>
[cite_start]<span class="yaml-key">macro-paths:</span> [<span class="yaml-string">"macros"</span>] <span class="cite">[cite: 167]</span>
[cite_start]<span class="yaml-key">test-paths:</span> [<span class="yaml-string">"tests"</span>] <span class="cite">[cite: 168]</span>
[cite_start]<span class="yaml-key">analysis-paths:</span> [<span class="yaml-string">"analyses"</span>] <span class="cite">[cite: 169]</span>

[cite_start]<span class="yaml-key">clean-targets:</span> <span class="comment"># directories to clean when 'dbt clean' is run</span> <span class="cite">[cite: 170]</span>
  - [cite_start]<span class="yaml-string">"target"</span> <span class="cite">[cite: 170]</span>
  - [cite_start]<span class="yaml-string">"dbt_packages"</span> <span class="cite">[cite: 171]</span>
  - [cite_start]<span class="yaml-string">"logs"</span> <span class="cite">[cite: 172]</span>

[cite_start]<span class="comment"># Define variables</span> <span class="cite">[cite: 173]</span>
[cite_start]<span class="yaml-key">vars:</span> <span class="cite">[cite: 174]</span>
  [cite_start]<span class="yaml-key">project_start_date:</span> <span class="yaml-string">'2023-01-01'</span> <span class="comment"># Used for filtering</span> <span class="cite">[cite: 175]</span>

<span class="comment"># Configure models, materializations, schemas, and tags</span>
[cite_start]<span class="yaml-key">models:</span> <span class="cite">[cite: 176]</span>
  [cite_start]<span class="yaml-key">ecom_analytics:</span> <span class="cite">[cite: 177]</span>
    <span class="comment"># Default materialization for all models in this project</span>
    [cite_start]<span class="yaml-key">+materialized:</span> <span class="yaml-string">view</span> <span class="cite">[cite: 178]</span>
    
    [cite_start]<span class="yaml-key">staging:</span> <span class="cite">[cite: 179]</span>
      [cite_start]<span class="comment"># Staging models are ephemeral by default</span> <span class="cite">[cite: 181]</span>
      [cite_start]<span class="yaml-key">+materialized:</span> <span class="yaml-string">ephemeral</span> <span class="cite">[cite: 182]</span>
      <span class="comment"># Group staging models into a dedicated schema</span>
      [cite_start]<span class="yaml-key">+schema:</span> <span class="yaml-string">raw_stage</span> <span class="cite">[cite: 184]</span>
      [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Staging layer for raw data, focusing on minimal cleaning and standardization."</span> <span class="cite">[cite: 186]</span>
    
    [cite_start]<span class="yaml-key">intermediate:</span> <span class="cite">[cite: 187]</span>
      [cite_start]<span class="comment"># Intermediate models are ephemeral</span> <span class="cite">[cite: 188]</span>
      [cite_start]<span class="yaml-key">+materialized:</span> <span class="yaml-string">ephemeral</span> <span class="cite">[cite: 188]</span>
      [cite_start]<span class="yaml-key">+schema:</span> <span class="yaml-string">int_stage</span> <span class="cite">[cite: 190]</span>
      [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Intermediate layer for joining and transforming staging data, not directly consumed by BI."</span> <span class="cite">[cite: 191, 180]</span>
    
    [cite_start]<span class="yaml-key">marts:</span> <span class="cite">[cite: 192]</span>
      [cite_start]<span class="comment"># Marts models are materialized as tables</span> <span class="cite">[cite: 193]</span>
      [cite_start]<span class="yaml-key">+materialized:</span> <span class="yaml-string">table</span> <span class="cite">[cite: 194]</span>
      [cite_start]<span class="yaml-key">+schema:</span> <span class="yaml-string">analytics</span> <span class="cite">[cite: 196]</span>
      [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Marts layer for business-friendly, aggregated, and highly curated data for analytics."</span> <span class="cite">[cite: 198]</span>
      [cite_start]<span class="yaml-key">+tags:</span> [<span class="yaml-string">'analytics_ready'</span>] <span class="cite">[cite: 200]</span>
      
      [cite_start]<span class="comment"># Specific configurations for individual marts models</span> <span class="cite">[cite: 201]</span>
      [cite_start]<span class="yaml-key">fact_orders:</span> <span class="cite">[cite: 202]</span>
        [cite_start]<span class="yaml-key">+tags:</span> [<span class="yaml-string">'daily_refresh'</span>, <span class="yaml-string">'sales'</span>] <span class="cite">[cite: 203]</span>
        [cite_start]<span class="yaml-key">+docs:</span> <span class="cite">[cite: 204]</span>
          [cite_start]<span class="yaml-key">node_color:</span> <span class="yaml-string">"#82a170"</span> <span class="cite">[cite: 205]</span>
      [cite_start]<span class="yaml-key">dim_customers:</span> <span class="cite">[cite: 206]</span>
        [cite_start]<span class="yaml-key">+tags:</span> [<span class="yaml-string">'daily_refresh'</span>, <span class="yaml-string">'customer'</span>] <span class="cite">[cite: 207]</span>
        [cite_start]<span class="yaml-key">+docs:</span> <span class="cite">[cite: 207]</span>
          [cite_start]<span class="yaml-key">node_color:</span> <span class="yaml-string">"#6b8e23"</span> <span class="cite">[cite: 208]</span>

[cite_start]<span class="comment"># Define an on-run-end hook</span> <span class="cite">[cite: 209]</span>
[cite_start]<span class="yaml-key">on-run-end:</span> <span class="cite">[cite: 210]</span>
  - [cite_start]<span class="yaml-string">"{{ log('dbt run completed successfully for target.name environment at ' ~ run_started_at, info=True) }}"</span> <span class="cite">[cite: 211]</span>
  - [cite_start]<span class="yaml-string">"{{ dbt_utils.log_info(target.name~' build finished. Total models: ' ~ results | length) }}"</span> <span class="cite">[cite: 212]</span>
</code></pre></div>
                                <div class="explanation">
                                    <h6 class="fw-bold"><i class="bi bi-info-circle-fill me-2"></i>Explanation</h6>
                                    <ul>
                                        <li><strong>profile:</strong> Links to your <code>profiles.yml</code> connection. [cite_start]<span class="cite">[cite: 215]</span></li>
                                        <li><strong>paths:</strong> Defines where dbt finds your files (models, seeds, etc.). [cite_start]<span class="cite">[cite: 218]</span></li>
                                        <li><strong>vars:</strong> Defines a global variable <code>project_start_date</code>. [cite_start]<span class="cite">[cite: 220]</span></li>
                                        <li><strong>models configuration:</strong> This is the core. [cite_start]It sets a project-wide default materialization (<code>view</code>) <span class="cite">[cite: 222]</span> and then overrides it for each layer: <code>staging</code> (ephemeral), <code>intermediate</code> (ephemeral), and <code>marts</code> (table). [cite_start]<span class="cite">[cite: 225]</span> It also assigns different schemas (<code>raw_stage</code>, <code>int_stage</code>, <code>analytics</code>) to each layer. [cite_start]<span class="cite">[cite: 226]</span></li>
                                        <li><strong>on-run-end:</strong> Executes Jinja/SQL after a run completes, here logging a success message. [cite_start]<span class="cite">[cite: 229]</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#file-2" aria-expanded="false" aria-controls="file-2">
                                <i class="bi bi-box-seam me-2"></i> <strong><code>packages.yml</code></strong> (Project Root)
                            </button>
                        </h2>
                        <div id="file-2" class="accordion-collapse collapse" data-bs-parent="#projectFilesAccordion">
                            <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="comment"># packages.yml</span> <span class="cite">[cite: 232]</span>
[cite_start]<span class="yaml-key">packages:</span> <span class="cite">[cite: 233]</span>
  - [cite_start]<span class="yaml-key">package:</span> <span class="yaml-string">dbt-labs/dbt_utils</span> <span class="cite">[cite: 234]</span>
    [cite_start]<span class="yaml-key">version:</span> <span class="yaml-string">1.1.1</span> <span class="comment"># Use the latest stable version you prefer</span> <span class="cite">[cite: 235]</span>
  - [cite_start]<span class="yaml-key">package:</span> <span class="yaml-string">dbt-labs/dbt_expectations</span> <span class="cite">[cite: 236]</span>
    [cite_start]<span class="yaml-key">version:</span> <span class="yaml-string">0.10.0</span> <span class="comment"># Use the latest stable version you prefer</span> <span class="cite">[cite: 237]</span>
</code></pre></div>
                                <div class="explanation">
                                    <h6 class="fw-bold"><i class="bi bi-info-circle-fill me-2"></i>Explanation</h6>
                                    <p>Defines external dbt packages to install. [cite_start]<span class="cite">[cite: 239]</span></p>
                                    <ul>
                                        <li><strong>dbt_utils:</strong> Provides common SQL macros (e.g., <code>surrogate_key</code>, <code>datediff</code>). [cite_start]<span class="cite">[cite: 240]</span></li>
                                        <li><strong>dbt_expectations:</strong> Provides a rich set of data quality tests (e.g., <code>expect_column_values_to_be_between</code>). [cite_start]<span class="cite">[cite: 242]</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#file-3" aria-expanded="false" aria-controls="file-3">
                                <i class="bi bi-filetype-csv me-2"></i> <strong><code>data/product_categories.csv</code></strong>
                            </button>
                        </h2>
                        <div id="file-3" class="accordion-collapse collapse" data-bs-parent="#projectFilesAccordion">
                            <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-csv">category_id,category_name,is_active,last_updated_at <span class="cite">[cite: 245]</span>
[cite_start]1,Electronics,TRUE,2024-01-01 <span class="cite">[cite: 246]</span>
[cite_start]2,Books,TRUE,2024-01-05 <span class="cite">[cite: 247]</span>
[cite_start]3,Apparel,TRUE,2024-01-10 <span class="cite">[cite: 248]</span>
[cite_start]4,Home Goods,FALSE,2024-01-15 <span class="cite">[cite: 249]</span>
[cite_start]5,Sports & Outdoors,TRUE,2024-01-20 <span class="cite">[cite: 250]</span>
</code></pre></div>
                                <div class="explanation">
                                    <h6 class="fw-bold"><i class="bi bi-info-circle-fill me-2"></i>Explanation</h6>
                                    <p>A simple CSV file representing static lookup data. [cite_start]<span class="cite">[cite: 252]</span> This will be loaded as a table named <code>product_categories</code> in your target schema when you run <code>dbt seed</code>. [cite_start]<span class="cite">[cite: 253]</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#file-4" aria-expanded="false" aria-controls="file-4">
                                <i class="bi bi-tools me-2"></i> <strong><code>macros/</code></strong> (Directory)
                            </button>
                        </h2>
                        <div id="file-4" class="accordion-collapse collapse" data-bs-parent="#projectFilesAccordion">
                            <div class="accordion-body">
                                <p>This directory contains custom macros and tests. [cite_start]<span class="cite">[cite: 17]</span></p>
                                <ul class="nav nav-tabs nav-tabs-secondary" id="macroTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="macro-1-tab" data-bs-toggle="tab" data-bs-target="#macro-1-pane" type="button" role="tab">get_current_timestamp.sql</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="macro-2-tab" data-bs-toggle="tab" data-bs-target="#macro-2-pane" type="button" role="tab">test_is_positive_number.sql</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="macro-3-tab" data-bs-toggle="tab" data-bs-target="#macro-3-pane" type="button" role="tab">schema.yml</button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="macroTabsContent">
                                    <div class="tab-pane fade show active" id="macro-1-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>macros/get_current_timestamp.sql</code> <span class="cite">[cite: 255]</span></h6>
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="sql-function">{% macro</span> get_current_timestamp() <span class="sql-function">%}</span> <span class="cite">[cite: 258]</span>
  [cite_start]<span class="comment">-- Returns the current UTC timestamp</span> <span class="cite">[cite: 259]</span>
  [cite_start]<span class="comment">-- Example usage: SELECT ..., {{ get_current_timestamp() }} as loaded_at</span> <span class="cite">[cite: 260]</span>
  [cite_start]<span class="sql-keyword">CURRENT_TIMESTAMP</span>() <span class="cite">[cite: 261]</span>
[cite_start]<span class="sql-function">{% endmacro %}</span> <span class="cite">[cite: 262]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>A simple Jinja macro that returns the database's current timestamp. [cite_start]<span class="cite">[cite: 264]</span> Useful for adding audit columns like <code>loaded_at</code>. [cite_start]<span class="cite">[cite: 265]</span></p>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="macro-2-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>macros/test_is_positive_number.sql</code> (Custom Generic Test) <span class="cite">[cite: 266, 268]</span></h6>
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="sql-function">{% test</span> is_positive_number(model, column_name) <span class="sql-function">%}</span> <span class="cite">[cite: 269]</span>
  [cite_start]<span class="comment">-- Custom generic test to check if a numeric column contains only positive values.</span> <span class="cite">[cite: 270]</span>
  [cite_start]<span class="comment">-- This test will pass if all values are > 0.</span> <span class="cite">[cite: 271]</span>
  <span class="sql-keyword">SELECT</span>
    [cite_start]{{ column_name }} <span class="cite">[cite: 277]</span>
  [cite_start]<span class="sql-keyword">FROM</span> {{ model }} <span class="cite">[cite: 278]</span>
  [cite_start]<span class="sql-keyword">WHERE</span> {{ column_name }} &lt;= 0 <span class="cite">[cite: 279]</span>
[cite_start]<span class="sql-function">{% endtest %}</span> <span class="cite">[cite: 280]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>Defines a custom generic test named <code>is_positive_number</code>. [cite_start]<span class="cite">[cite: 283]</span> dbt passes in <code>model</code> and <code>column_name</code>. [cite_start]<span class="cite">[cite: 284]</span> The test fails if the SQL query returns any rows (i.e., if any values are 0 or negative). [cite_start]<span class="cite">[cite: 285]</span></p>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="macro-3-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>macros/schema.yml</code> (Macro Documentation) <span class="cite">[cite: 287]</span></h6>
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 289]</span>
[cite_start]<span class="yaml-key">macros:</span> <span class="cite">[cite: 290]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">get_current_timestamp</span> <span class="cite">[cite: 291]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Returns the current UTC timestamp from the data warehouse. Useful for audit columns like 'loaded_at'."</span> <span class="cite">[cite: 292]</span>
    
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">is_positive_number</span> <span class="cite">[cite: 293]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Custom generic test to assert that all values in a numeric column are strictly positive (greater than 0)."</span> <span class="cite">[cite: 294, 295]</span>
    [cite_start]<span class="yaml-key">arguments:</span> <span class="cite">[cite: 296]</span>
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">column_name</span> <span class="cite">[cite: 297]</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"The name of the column to test for positive values."</span> <span class="cite">[cite: 298]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>This YAML file documents the custom macros, providing descriptions for the macros and their arguments. [cite_start]<span class="cite">[cite: 300, 301]</span> This information will appear in the dbt Docs UI. [cite_start]<span class="cite">[cite: 302]</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#file-5" aria-expanded="false" aria-controls="file-5">
                                <i class="bi bi-folder-fill me-2" style="color: var(--bs-primary);"></i> <strong><code>models/</code></strong> (Directory)
                            </button>
                        </h2>
                        <div id="file-5" class="accordion-collapse collapse" data-bs-parent="#projectFilesAccordion">
                            <div class="accordion-body">
                                <p>This is the core directory containing all data transformations, organized into layers. [cite_start]<span class="cite">[cite: 25]</span></p>
                                <ul class="nav nav-tabs nav-tabs-secondary" id="modelTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="model-1-tab" data-bs-toggle="tab" data-bs-target="#model-1-pane" type="button" role="tab">sources.yml</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="model-2-tab" data-bs-toggle="tab" data-bs-target="#model-2-pane" type="button" role="tab">staging/</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="model-3-tab" data-bs-toggle="tab" data-bs-target="#model-3-pane" type="button" role="tab">intermediate/</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="model-4-tab" data-bs-toggle="tab" data-bs-target="#model-4-pane" type="button" role="tab">marts/</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="model-5-tab" data-bs-toggle="tab" data-bs-target="#model-5-pane" type="button" role="tab">exposures.yml</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="model-6-tab" data-bs-toggle="tab" data-bs-target="#model-6-pane" type="button" role="tab">metrics.yml</button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="modelTabsContent">
                                    <div class="tab-pane fade show active" id="model-1-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/sources.yml</code> <span class="cite">[cite: 304]</span></h6>
                                        <div class="alert alert-warning mt-2">
                                            <strong>Remember:</strong> Replace <code>your_database</code> and <code>your_schema</code> with your actual raw data location. [cite_start]<span class="cite">[cite: 309, 310]</span>
                                        </div>
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 306]</span>
[cite_start]<span class="yaml-key">sources:</span> <span class="cite">[cite: 307]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">raw_ecommerce_data</span> <span class="comment"># Logical grouping</span> <span class="cite">[cite: 308]</span>
    [cite_start]<span class="yaml-key">database:</span> <span class="yaml-string">your_database</span> <span class="cite">[cite: 309]</span>
    [cite_start]<span class="yaml-key">schema:</span> <span class="yaml-string">your_schema</span> <span class="cite">[cite: 310]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Contains raw, untransformed data ingested directly..."</span> <span class="cite">[cite: 310]</span>
    
    [cite_start]<span class="yaml-key">tables:</span> <span class="cite">[cite: 311]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">raw_customers</span>
        <span class="yaml-key">description:</span> <span class="yaml-string">"Raw customer demographic and registration information..."</span>
        <span class="yaml-key">loaded_at_field:</span> <span class="yaml-string">updated_at</span> <span class="comment"># Column to check freshness</span>
        <span class="yaml-key">freshness:</span>
          <span class="yaml-key">warn_after:</span> {<span class="yaml-key">count:</span> 24, <span class="yaml-key">period:</span> hour}
          <span class="yaml-key">error_after:</span> {<span class="yaml-key">count:</span> 48, <span class="yaml-key">period:</span> hour}
        <span class="yaml-key">columns:</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span>
            <span class="yaml-key">description:</span> <span class="yaml-string">"Unique identifier for the customer."</span>
            <span class="yaml-key">tests:</span>
              - <span class="yaml-string">unique</span>
              - <span class="yaml-string">not_null</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">email</span>
            <span class="yaml-key">description:</span> <span class="yaml-string">"Customer's email address. Potentially PII."</span>
            [cite_start]<span class="yaml-key">tags:</span> [<span class="yaml-string">'pii'</span>] <span class="cite">[cite: 313]</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 315]</span>

      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">raw_orders</span> <span class="cite">[cite: 318]</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Raw transactional data for customer orders."</span> <span class="cite">[cite: 319]</span>
        [cite_start]<span class="yaml-key">loaded_at_field:</span> <span class="yaml-string">order_date</span> <span class="cite">[cite: 320]</span>
        <span class="yaml-key">freshness:</span>
          [cite_start]<span class="yaml-key">warn_after:</span> {<span class="yaml-key">count:</span> 1, <span class="yaml-key">period:</span> day} <span class="cite">[cite: 321]</span>
          [cite_start]<span class="yaml-key">error_after:</span> {<span class="yaml-key">count:</span> 2, <span class="yaml-key">period:</span> day} <span class="cite">[cite: 322]</span>
        <span class="yaml-key">columns:</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">order_id</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">unique</span> <span class="cite">[cite: 327]</span>
              - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 328]</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span>
            [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Foreign key linking to raw_customers."</span> <span class="cite">[cite: 330]</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 332]</span>
              - [cite_start]<span class="yaml-key">relationships:</span> <span class="cite">[cite: 333]</span>
                  [cite_start]<span class="yaml-key">to:</span> <span class="yaml-string">source('raw_ecommerce_data', 'raw_customers')</span> <span class="cite">[cite: 334]</span>
                  [cite_start]<span class="yaml-key">field:</span> <span class="yaml-string">customer_id</span> <span class="cite">[cite: 335]</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">amount</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-key">dbt_expectations.expect_column_values_to_be_between:</span> <span class="cite">[cite: 339]</span>
                  [cite_start]<span class="yaml-key">min_value:</span> <span class="yaml-string">0.01</span> <span class="cite">[cite: 340]</span>
                  [cite_start]<span class="yaml-key">max_value:</span> <span class="yaml-string">10000.00</span> <span class="cite">[cite: 341]</span>
                  
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">raw_payments</span> <span class="cite">[cite: 342]</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Raw payment details for each order."</span> <span class="cite">[cite: 343]</span>
        [cite_start]<span class="yaml-key">loaded_at_field:</span> <span class="yaml-string">payment_date</span> <span class="cite">[cite: 344]</span>
        <span class="yaml-key">freshness:</span>
          [cite_start]<span class="yaml-key">warn_after:</span> {<span class="yaml-key">count:</span> 6, <span class="yaml-key">period:</span> hour} <span class="cite">[cite: 346]</span>
          [cite_start]<span class="yaml-key">error_after:</span> {<span class="yaml-key">count:</span> 12, <span class="yaml-key">period:</span> hour} <span class="cite">[cite: 347]</span>
        <span class="yaml-key">columns:</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">payment_id</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">unique</span> <span class="cite">[cite: 352]</span>
              - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 353]</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">order_id</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 357]</span>
              - [cite_start]<span class="yaml-key">relationships:</span> <span class="cite">[cite: 358]</span>
                  [cite_start]<span class="yaml-key">to:</span> <span class="yaml-string">source('raw_ecommerce_data', 'raw_orders')</span> <span class="cite">[cite: 359]</span>
                  [cite_start]<span class="yaml-key">field:</span> <span class="yaml-string">order_id</span> <span class="cite">[cite: 359]</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">payment_method</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-key">accepted_values:</span> <span class="cite">[cite: 362]</span>
                  [cite_start]<span class="yaml-key">values:</span> [<span class="yaml-string">'credit_card'</span>, <span class="yaml-string">'bank_transfer'</span>, <span class="yaml-string">'gift_card'</span>, <span class="yaml-string">'paypal'</span>] <span class="cite">[cite: 363]</span>
          - <span class="yaml-key">name:</span> <span class="yaml-string">amount</span>
            <span class="yaml-key">tests:</span>
              - [cite_start]<span class="yaml-string">is_positive_number</span> <span class="comment"># Using our custom generic test!</span> <span class="cite">[cite: 366]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <h6 class="fw-bold"><i class="bi bi-info-circle-fill me-2"></i>Explanation</h6>
                                            <ul>
                                                <li>Defines the three raw source tables: <code>raw_customers</code>, <code>raw_orders</code>, <code>raw_payments</code>. [cite_start]<span class="cite">[cite: 368]</span></li>
                                                <li>Includes descriptions, column descriptions, and <strong>freshness checks</strong> to monitor data ingestion latency. [cite_start]<span class="cite">[cite: 369, 370, 371]</span></li>
                                                <li>Applies standard tests (<code>unique</code>, <code>not_null</code>, <code>relationships</code>, <code>accepted_values</code>). [cite_start]<span class="cite">[cite: 372]</span></li>
                                                <li>Uses a <code>dbt_expectations</code> test (<code>expect_column_values_to_be_between</code>). [cite_start]<span class="cite">[cite: 373]</span></li>
                                                <li>Uses our <strong>custom generic test</strong> <code>is_positive_number</code> on <code>raw_payments.amount</code>. [cite_start]<span class="cite">[cite: 374]</span></li>
                                                <li>Shows column-level tagging (<code>pii</code> on email). [cite_start]<span class="cite">[cite: 375]</span></li>
                                            </ul>
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane fade" id="model-2-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/staging/</code> (Directory) <span class="cite">[cite: 376]</span></h6>
                                        <p>This layer performs light transformations, renaming, and type casting. [cite_start]<span class="cite">[cite: 26, 29]</span> These models are <strong>ephemeral</strong> as defined in <code>dbt_project.yml</code>. [cite_start]<span class="cite">[cite: 182]</span></p>
                                        <div class="accordion accordion-flush" id="stagingAccordion">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#staging-1" aria-expanded="false">
                                                        <code>staging_schema.yml</code>
                                                    </button>
                                                </h2>
                                                <div id="staging-1" class="accordion-collapse collapse" data-bs-parent="#stagingAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 380]</span>
[cite_start]<span class="yaml-key">models:</span> <span class="cite">[cite: 381]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">stg_customers</span> <span class="cite">[cite: 382]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Staging model for 'raw_customers'. Cleans and standardizes customer data."</span> <span class="cite">[cite: 383]</span>
    <span class="yaml-key">columns:</span>
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span> <span class="cite">[cite: 384]</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Unique identifier for the customer (primary key)."</span> <span class="cite">[cite: 385]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">email</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Customer's email address, converted to lowercase."</span> <span class="cite">[cite: 391]</span>
        
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">stg_orders</span> <span class="cite">[cite: 394]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Staging model for 'raw_orders'. Cleans and standardizes order data."</span> <span class="cite">[cite: 395]</span>
    <span class="yaml-key">columns:</span>
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">order_id</span> <span class="cite">[cite: 396]</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Unique identifier for the order."</span> <span class="cite">[cite: 397]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Foreign key to 'stg_customers'."</span> <span class="cite">[cite: 399]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">order_total_amount</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Total amount of the order."</span> <span class="cite">[cite: 405]</span>

  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">stg_payments</span> <span class="cite">[cite: 406]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Staging model for 'raw_payments'. Cleans and standardizes payment data."</span> <span class="cite">[cite: 407]</span>
    <span class="yaml-key">columns:</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">payment_id</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Unique identifier for the payment."</span> <span class="cite">[cite: 409]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">order_id</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Foreign key to 'stg_orders'."</span> <span class="cite">[cite: 411]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">payment_amount</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Amount of this individual payment."</span> <span class="cite">[cite: 415]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">payment_status</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Status of the payment (e.g., 'completed', 'failed')."</span> <span class="cite">[cite: 419]</span>
</code></pre></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#staging-2" aria-expanded="false">
                                                        <code>stg_customers.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="staging-2" class="accordion-collapse collapse" data-bs-parent="#stagingAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/staging/stg_customers.sql</span> <span class="cite">[cite: 424]</span>
[cite_start]<span class="comment">-- Cleans and prepares raw customer data.</span> <span class="cite">[cite: 425]</span>
<span class="sql-keyword">SELECT</span>
    [cite_start]customer_id, <span class="cite">[cite: 427]</span>
    [cite_start]first_name, <span class="cite">[cite: 428]</span>
    [cite_start]last_name, <span class="cite">[cite: 429]</span>
    [cite_start]<span class="sql-function">LOWER</span>(email) <span class="sql-keyword">AS</span> email, <span class="comment">-- Standardize email</span> <span class="cite">[cite: 430]</span>
    [cite_start]registration_date, <span class="cite">[cite: 431]</span>
    [cite_start]updated_at <span class="cite">[cite: 432]</span>
[cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">source</span>('raw_ecommerce_data', 'raw_customers') }} <span class="cite">[cite: 433]</span>
[cite_start]<span class="sql-keyword">WHERE</span> customer_id <span class="sql-keyword">IS NOT NULL</span> <span class="cite">[cite: 433]</span>
</code></pre></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#staging-3" aria-expanded="false">
                                                        <code>stg_orders.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="staging-3" class="accordion-collapse collapse" data-bs-parent="#stagingAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/staging/stg_orders.sql</span> <span class="cite">[cite: 441]</span>
<span class="sql-keyword">SELECT</span>
    [cite_start]order_id, <span class="cite">[cite: 443]</span>
    [cite_start]customer_id, <span class="cite">[cite: 444]</span>
    [cite_start]order_date, <span class="cite">[cite: 445]</span>
    [cite_start]order_status, <span class="cite">[cite: 446]</span>
    [cite_start]amount <span class="sql-keyword">AS</span> order_total_amount <span class="comment">-- Rename for clarity</span> <span class="cite">[cite: 447]</span>
[cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">source</span>('raw_ecommerce_data', 'raw_orders') }} <span class="cite">[cite: 447]</span>
[cite_start]<span class="sql-keyword">WHERE</span> order_id <span class="sql-keyword">IS NOT NULL</span> <span class="cite">[cite: 447]</span>
</code></pre></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#staging-4" aria-expanded="false">
                                                        <code>stg_payments.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="staging-4" class="accordion-collapse collapse" data-bs-parent="#stagingAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/staging/stg_payments.sql</span> <span class="cite">[cite: 453]</span>
<span class="sql-keyword">SELECT</span>
    [cite_start]payment_id, <span class="cite">[cite: 455]</span>
    [cite_start]order_id, <span class="cite">[cite: 456]</span>
    [cite_start]payment_method, <span class="cite">[cite: 457]</span>
    [cite_start]amount <span class="sql-keyword">AS</span> payment_amount, <span class="comment">-- Rename</span> <span class="cite">[cite: 458]</span>
    [cite_start]payment_date, <span class="cite">[cite: 459]</span>
    [cite_start]status <span class="sql-keyword">AS</span> payment_status <span class="comment">-- Rename</span> <span class="cite">[cite: 460, 461]</span>
[cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">source</span>('raw_ecommerce_data', 'raw_payments') }} <span class="cite">[cite: 462]</span>
[cite_start]<span class="sql-keyword">WHERE</span> payment_id <span class="sql-keyword">IS NOT NULL</span> <span class="cite">[cite: 463]</span>
</code></pre></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane fade" id="model-3-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/intermediate/</code> (Directory) <span class="cite">[cite: 467]</span></h6>
                                        <p>This layer joins staging models and performs more complex transformations. [cite_start]<span class="cite">[cite: 36, 37]</span> These models are also <strong>ephemeral</strong>, acting as CTEs for the final mart models. [cite_start]<span class="cite">[cite: 188, 546]</span></p>
                                        <div class="accordion accordion-flush" id="intermediateAccordion">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#int-1" aria-expanded="false">
                                                        <code>intermediate_schema.yml</code>
                                                    </button>
                                                </h2>
                                                <div id="int-1" class="accordion-collapse collapse" data-bs-parent="#intermediateAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 470]</span>
[cite_start]<span class="yaml-key">models:</span> <span class="cite">[cite: 471]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">int_customer_order_payments</span> <span class="cite">[cite: 472]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Combines customer, order, and payment data at the order level. Serves as an intermediate step..."</span> <span class="cite">[cite: 473]</span>
    [cite_start]<span class="yaml-key">columns:</span> <span class="cite">[cite: 474]</span>
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">order_id</span> <span class="cite">[cite: 475]</span>
      - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span> <span class="cite">[cite: 477]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_name</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Full name of the customer (first name + last name)."</span> <span class="cite">[cite: 486]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">total_payments</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Sum of all payments received for this order."</span> <span class="cite">[cite: 490]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">payment_methods_used</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Comma-separated list of unique payment methods used for this order."</span> <span class="cite">[cite: 491]</span>
</code></pre></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#int-2" aria-expanded="false">
                                                        <code>int_customer_order_payments.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="int-2" class="accordion-collapse collapse" data-bs-parent="#intermediateAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/intermediate/int_customer_order_payments.sql</span> <span class="cite">[cite: 496]</span>
<span class="sql-keyword">WITH</span> orders <span class="sql-keyword">AS</span> (
    [cite_start]<span class="sql-keyword">SELECT</span> * <span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('stg_orders') }} <span class="cite">[cite: 504]</span>
),
customers <span class="sql-keyword">AS</span> (
    <span class="sql-keyword">SELECT</span>
        [cite_start]customer_id, <span class="cite">[cite: 509]</span>
        [cite_start]first_name, <span class="cite">[cite: 510]</span>
        [cite_start]last_name, <span class="cite">[cite: 511]</span>
        [cite_start]email <span class="sql-keyword">AS</span> customer_email <span class="cite">[cite: 512]</span>
    [cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('stg_customers') }} <span class="cite">[cite: 513]</span>
),
payments <span class="sql-keyword">AS</span> (
    <span class="sql-keyword">SELECT</span>
        [cite_start]order_id, <span class="cite">[cite: 516]</span>
        [cite_start]payment_amount, <span class="cite">[cite: 517]</span>
        [cite_start]payment_method <span class="cite">[cite: 519]</span>
    [cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('stg_payments') }} <span class="cite">[cite: 520]</span>
),
order_payments_agg <span class="sql-keyword">AS</span> (
    <span class="sql-keyword">SELECT</span>
        [cite_start]order_id, <span class="cite">[cite: 523]</span>
        [cite_start]<span class="sql-function">SUM</span>(payment_amount) <span class="sql-keyword">AS</span> total_payments, <span class="cite">[cite: 524]</span>
        [cite_start]<span class="sql-function">LISTAGG</span>(<span class="sql-keyword">DISTINCT</span> payment_method, ', ') <span class="sql-keyword">WITHIN GROUP</span> (<span class="sql-keyword">ORDER BY</span> payment_method) <span class="sql-keyword">AS</span> payment_methods_used <span class="cite">[cite: 525, 526]</span>
    <span class="sql-keyword">FROM</span> payments
    [cite_start]<span class="sql-keyword">GROUP BY</span> order_id <span class="cite">[cite: 528]</span>
)
<span class="sql-keyword">SELECT</span>
    [cite_start]o.order_id, <span class="cite">[cite: 531]</span>
    [cite_start]o.customer_id, <span class="cite">[cite: 532]</span>
    [cite_start]o.order_date, <span class="cite">[cite: 533]</span>
    [cite_start]o.order_status, <span class="cite">[cite: 534]</span>
    [cite_start]o.order_total_amount, <span class="cite">[cite: 535]</span>
    c.first_name || [cite_start]' ' || c.last_name <span class="sql-keyword">AS</span> customer_name, <span class="comment">-- Concatenate names</span> <span class="cite">[cite: 536]</span>
    [cite_start]c.customer_email, <span class="cite">[cite: 537]</span>
    [cite_start]<span class="sql-function">COALESCE</span>(opa.total_payments, 0) <span class="sql-keyword">AS</span> total_payments, <span class="comment">-- Handle orders with no payments</span> <span class="cite">[cite: 538]</span>
    [cite_start]<span class="sql-function">COALESCE</span>(opa.payment_methods_used, 'No Payments') <span class="sql-keyword">AS</span> payment_methods_used <span class="cite">[cite: 538]</span>
<span class="sql-keyword">FROM</span> orders o
[cite_start]<span class="sql-keyword">LEFT JOIN</span> customers c <span class="sql-keyword">ON</span> o.customer_id = c.customer_id <span class="cite">[cite: 540]</span>
[cite_start]<span class="sql-keyword">LEFT JOIN</span> order_payments_agg opa <span class="sql-keyword">ON</span> o.order_id = opa.order_id <span class="cite">[cite: 541]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>This model joins the three staging models using <code>ref()</code>. [cite_start]<span class="cite">[cite: 544][cite_start]</span> It performs aggregations (<code>SUM</code>, <code>LISTAGG</code>) on the payment data <span class="cite">[cite: 544]</span> and uses <code>COALESCE</code> to handle NULLs. [cite_start]<span class="cite">[cite: 545]</span></p>
                                        </div>
                                    </div>
                                </div>
                                    </div>

                                    <div class="tab-pane fade" id="model-4-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/marts/</code> (Directory) <span class="cite">[cite: 548]</span></h6>
                                        <p>The final layer, providing clean, business-friendly tables for analytics. [cite_start]<span class="cite">[cite: 198]</span> These models are materialized as <strong>tables</strong> for performance, as defined in <code>dbt_project.yml</code>. [cite_start]<span class="cite">[cite: 194]</span></p>
                                        <div class="accordion accordion-flush" id="martsAccordion">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mart-1" aria-expanded="false">
                                                        <code>marts_schema.yml</code>
                                                    </button>
                                                </h2>
                                                <div id="mart-1" class="accordion-collapse collapse" data-bs-parent="#martsAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 551]</span>
[cite_start]<span class="yaml-key">models:</span> <span class="cite">[cite: 552]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">dim_customers</span> <span class="cite">[cite: 553]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"The primary customer dimension table. Contains cleansed, unique customer records..."</span> <span class="cite">[cite: 554, 555]</span>
    <span class="yaml-key">columns:</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_sk</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Surrogate key for the customer dimension (hash of customer_id)."</span> <span class="cite">[cite: 557, 558]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">unique</span> <span class="cite">[cite: 560]</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 561]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Natural key for the customer."</span> <span class="cite">[cite: 563]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 565]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_email</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-key">dbt_expectations.expect_column_to_match_regex:</span> <span class="cite">[cite: 571]</span>
              [cite_start]<span class="yaml-key">regex:</span> <span class="yaml-string">'^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'</span> <span class="cite">[cite: 572]</span>
          - [cite_start]<span class="yaml-key">dbt_expectations.expect_column_to_be_unique_within_n_percent:</span> <span class="cite">[cite: 573]</span>
              [cite_start]<span class="yaml-key">percent_of_total:</span> <span class="yaml-string">100</span> <span class="cite">[cite: 574]</span>
              
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">fact_orders</span> <span class="cite">[cite: 579]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"A comprehensive fact table containing all completed orders..."</span> <span class="cite">[cite: 580]</span>
    <span class="yaml-key">columns:</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">order_id</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">unique</span> <span class="cite">[cite: 585]</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 586]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">customer_id</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Foreign key linking to 'dim_customers'."</span> <span class="cite">[cite: 588]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 590]</span>
          - [cite_start]<span class="yaml-key">relationships:</span> <span class="cite">[cite: 591]</span>
              [cite_start]<span class="yaml-key">to:</span> <span class="yaml-string">ref('dim_customers')</span> <span class="cite">[cite: 592]</span>
              [cite_start]<span class="yaml-key">field:</span> <span class="yaml-string">customer_id</span> <span class="cite">[cite: 593]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">order_total_amount</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Total amount of the order. Expected to be positive."</span> <span class="cite">[cite: 601]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 603]</span>
          - [cite_start]<span class="yaml-string">is_positive_number</span> <span class="comment"># Custom test!</span> <span class="cite">[cite: 604]</span>
          - [cite_start]<span class="yaml-key">dbt_expectations.expect_column_values_to_be_between:</span> <span class="cite">[cite: 604]</span>
              [cite_start]<span class="yaml-key">min_value:</span> <span class="yaml-string">0.01</span> <span class="cite">[cite: 605]</span>
              [cite_start]<span class="yaml-key">max_value:</span> <span class="yaml-string">10000.00</span> <span class="cite">[cite: 606]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">total_payments_received</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Total sum of payments recorded for this order."</span> <span class="cite">[cite: 608]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-key">dbt_expectations.expect_column_pair_values_to_be_equal:</span> <span class="cite">[cite: 613]</span>
              [cite_start]<span class="yaml-key">column_A:</span> <span class="yaml-string">order_total_amount</span> <span class="cite">[cite: 614]</span>
              [cite_start]<span class="yaml-key">column_B:</span> <span class="yaml-string">total_payments_received</span> <span class="cite">[cite: 615]</span>
              [cite_start]<span class="yaml-key">row_condition:</span> <span class="yaml-string">"order_status = 'completed'"</span> <span class="cite">[cite: 616]</span>
      - <span class="yaml-key">name:</span> <span class="yaml-string">num_payments</span>
        [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Count of individual payment transactions."</span> <span class="cite">[cite: 618]</span>
        <span class="yaml-key">tests:</span>
          - [cite_start]<span class="yaml-string">not_null</span> <span class="cite">[cite: 619]</span>
          - [cite_start]<span class="yaml-string">is_positive_number</span> <span class="cite">[cite: 620]</span>
</code></pre></div>
                                                        <div class="explanation">
                                                            <p>Applies rich documentation and advanced <code>dbt_expectations</code> tests (regex, uniqueness, column pair comparison) to the final mart tables. [cite_start]<span class="cite">[cite: 624, 627, 628][cite_start]</span> It also re-uses the <code>is_positive_number</code> custom test <span class="cite">[cite: 629]</span> and adds a <code>relationships</code> test to ensure referential integrity between the fact and dimension tables. [cite_start]<span class="cite">[cite: 631, 632]</span></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mart-2" aria-expanded="false">
                                                        <code>dim_customers.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="mart-2" class="accordion-collapse collapse" data-bs-parent="#martsAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/marts/dim_customers.sql</span> <span class="cite">[cite: 635]</span>
[cite_start]<span class="comment">-- Creates the customer dimension table.</span> <span class="cite">[cite: 636]</span>
<span class="sql-keyword">SELECT</span>
    [cite_start]{{ <span class="sql-function">dbt_utils.surrogate_key</span>(['customer_id']) }} <span class="sql-keyword">AS</span> customer_sk, <span class="comment">-- Generate a surrogate key</span> <span class="cite">[cite: 638, 639]</span>
    [cite_start]customer_id, <span class="cite">[cite: 640]</span>
    first_name || [cite_start]' ' || last_name <span class="sql-keyword">AS</span> customer_name, <span class="cite">[cite: 641]</span>
    [cite_start]email <span class="sql-keyword">AS</span> customer_email, <span class="cite">[cite: 642]</span>
    [cite_start]registration_date <span class="cite">[cite: 643]</span>
[cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('stg_customers') }} <span class="cite">[cite: 644]</span>
[cite_start]<span class="sql-keyword">WHERE</span> customer_id <span class="sql-keyword">IS NOT NULL</span> <span class="cite">[cite: 645]</span>
</code></pre></div>
                                                        <div class="explanation">
                                                            <p>Creates the final customer dimension. [cite_start]<span class="cite">[cite: 647]</span> It uses <code>dbt_utils.surrogate_key</code> to generate a unique, consistent surrogate key (<code>customer_sk</code>) from the natural key (<code>customer_id</code>), which is a best practice for dimension tables. [cite_start]<span class="cite">[cite: 648, 649]</span></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mart-3" aria-expanded="false">
                                                        <code>fact_orders.sql</code>
                                                    </button>
                                                </h2>
                                                <div id="mart-3" class="accordion-collapse collapse" data-bs-parent="#martsAccordion">
                                                    <div class="accordion-body">
[cite_start]<div class="code-block"><pre><code class="language-sql"><span class="comment">-- models/marts/fact_orders.sql</span> <span class="cite">[cite: 652]</span>
[cite_start]<span class="comment">-- Creates the orders fact table.</span> <span class="cite">[cite: 653]</span>
<span class="sql-keyword">WITH</span> final_orders <span class="sql-keyword">AS</span> (
    <span class="sql-keyword">SELECT</span>
        [cite_start]order_id, <span class="cite">[cite: 657]</span>
        [cite_start]customer_id, <span class="cite">[cite: 658]</span>
        [cite_start]order_date, <span class="cite">[cite: 659]</span>
        [cite_start]order_status, <span class="cite">[cite: 660]</span>
        [cite_start]order_total_amount, <span class="cite">[cite: 661]</span>
        [cite_start]total_payments, <span class="cite">[cite: 662]</span>
        [cite_start]payment_methods_used <span class="cite">[cite: 663]</span>
    [cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('int_customer_order_payments') }} <span class="cite">[cite: 664]</span>
),
payments_count <span class="sql-keyword">AS</span> (
    <span class="sql-keyword">SELECT</span>
        [cite_start]order_id, <span class="cite">[cite: 667]</span>
        [cite_start]<span class="sql-function">COUNT</span>(payment_id) <span class="sql-keyword">AS</span> num_payments <span class="cite">[cite: 668]</span>
    [cite_start]<span class="sql-keyword">FROM</span> {{ <span class="sql-function">ref</span>('stg_payments') }} <span class="cite">[cite: 669]</span>
    [cite_start]<span class="sql-keyword">GROUP BY</span> 1 <span class="cite">[cite: 670]</span>
)
<span class="sql-keyword">SELECT</span>
    [cite_start]fo.order_id, <span class="cite">[cite: 673]</span>
    [cite_start]fo.customer_id, <span class="cite">[cite: 674]</span>
    [cite_start]fo.order_date, <span class="cite">[cite: 675]</span>
    [cite_start]fo.order_status, <span class="cite">[cite: 676]</span>
    [cite_start]fo.order_total_amount, <span class="cite">[cite: 677]</span>
    [cite_start]fo.total_payments <span class="sql-keyword">AS</span> total_payments_received, <span class="comment">-- Rename</span> <span class="cite">[cite: 678]</span>
    [cite_start]pc.num_payments, <span class="cite">[cite: 679]</span>
    [cite_start]fo.payment_methods_used, <span class="cite">[cite: 680]</span>
    [cite_start]{{ <span class="sql-function">get_current_timestamp</span>() }} <span class="sql-keyword">AS</span> loaded_at <span class="comment">-- Using our custom macro!</span> <span class="cite">[cite: 681]</span>
<span class="sql-keyword">FROM</span> final_orders fo
[cite_start]<span class="sql-keyword">LEFT JOIN</span> payments_count pc <span class="sql-keyword">ON</span> fo.order_id = pc.order_id <span class="cite">[cite: 682]</span>
</code></pre></div>
                                                        <div class="explanation">
                                                            <p>Creates the final <code>fact_orders</code> table. [cite_start]<span class="cite">[cite: 684][cite_start]</span> It selects from the <code>int_customer_order_payments</code> intermediate model <span class="cite">[cite: 685]</span> and joins again with <code>stg_payments</code> to get a count of payments (<code>num_payments</code>). [cite_start]<span class="cite">[cite: 685]</span> It also uses our <strong>custom macro</strong> <code>{{ get_current_timestamp() }}</code> to add a <code>loaded_at</code> audit column. [cite_start]<span class="cite">[cite: 686]</span></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane fade" id="model-5-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/exposures.yml</code> <span class="cite">[cite: 687]</span></h6>
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 690]</span>
[cite_start]<span class="yaml-key">exposures:</span> <span class="cite">[cite: 691]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">executive_dashboard</span> <span class="cite">[cite: 692]</span>
    [cite_start]<span class="yaml-key">type:</span> <span class="yaml-string">dashboard</span> <span class="cite">[cite: 693]</span>
    [cite_start]<span class="yaml-key">owner:</span> <span class="cite">[cite: 694]</span>
      [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">Data Leadership</span> <span class="cite">[cite: 695]</span>
      [cite_start]<span class="yaml-key">email:</span> <span class="yaml-string">data.leadership@example.com</span> <span class="cite">[cite: 696]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Key performance indicators... Source of truth for total revenue..."</span> <span class="cite">[cite: 697]</span>
    [cite_start]<span class="yaml-key">depends_on:</span> <span class="cite">[cite: 698]</span>
      - [cite_start]<span class="yaml-string">ref('fact_orders')</span> <span class="cite">[cite: 699]</span>
      - [cite_start]<span class="yaml-string">ref('dim_customers')</span> <span class="cite">[cite: 700]</span>
    [cite_start]<span class="yaml-key">url:</span> <span class="yaml-string">"https://bi.yourcompany.com/dashboards/executive"</span> <span class="cite">[cite: 701]</span>
    [cite_start]<span class="yaml-key">tags:</span> [<span class="yaml-string">'critical'</span>, <span class="yaml-string">'daily_reporting'</span>] <span class="cite">[cite: 702, 703, 704]</span>

  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">ml_model_customer_churn</span> <span class="cite">[cite: 705]</span>
    [cite_start]<span class="yaml-key">type:</span> <span class="yaml-string">ml</span> <span class="cite">[cite: 706]</span>
    [cite_start]<span class="yaml-key">owner:</span> <span class="cite">[cite: 707]</span>
      [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">Data Science Team</span> <span class="cite">[cite: 708]</span>
      [cite_start]<span class="yaml-key">email:</span> <span class="yaml-string">data.science@example.com</span> <span class="cite">[cite: 709]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Machine Learning model predicting customer churn..."</span> <span class="cite">[cite: 710]</span>
    [cite_start]<span class="yaml-key">depends_on:</span> <span class="cite">[cite: 711]</span>
      - [cite_start]<span class="yaml-string">ref('int_customer_order_payments')</span> <span class="comment"># ML models often use intermediate features</span> <span class="cite">[cite: 712]</span>
    [cite_start]<span class="yaml-key">url:</span> <span class="yaml-string">"https://gitlab.yourcompany.com/ds/churn_prediction"</span> <span class="cite">[cite: 713]</span>
    [cite_start]<span class="yaml-key">tags:</span> [<span class="yaml-string">'machine_learning'</span>, <span class="yaml-string">'customer_analytics'</span>] <span class="cite">[cite: 714, 715, 716]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>Defines two "exposures" (downstream consumers of your data): a dashboard and an ML model. [cite_start]<span class="cite">[cite: 718]</span> This documents their <code>type</code>, <code>owner</code>, <code>description</code>, and <code>url</code>. [cite_start]<span class="cite">[cite: 719]</span> Critically, <code>depends_on</code> links them to the dbt models they consume, completing the data lineage in dbt Docs. [cite_start]<span class="cite">[cite: 719, 720]</span></p>
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane fade" id="model-6-pane" role="tabpanel">
                                        [cite_start]<h6 class="mt-3 fw-bold"><code>models/metrics.yml</code> <span class="cite">[cite: 721]</span></h6>
[cite_start]<div class="code-block"><pre><code class="language-yaml"><span class="yaml-key">version:</span> <span class="yaml-string">2</span> <span class="cite">[cite: 724]</span>
[cite_start]<span class="yaml-key">metrics:</span> <span class="cite">[cite: 725]</span>
  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">total_revenue</span> <span class="cite">[cite: 726]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"The sum of all 'order_total_amount' for completed orders."</span> <span class="cite">[cite: 727]</span>
    [cite_start]<span class="yaml-key">model:</span> <span class="yaml-string">ref('fact_orders')</span> <span class="cite">[cite: 728]</span>
    [cite_start]<span class="yaml-key">calculation_method:</span> <span class="yaml-string">sum</span> <span class="cite">[cite: 729]</span>
    [cite_start]<span class="yaml-key">expression:</span> <span class="yaml-string">order_total_amount</span> <span class="cite">[cite: 730]</span>
    [cite_start]<span class="yaml-key">timestamp:</span> <span class="yaml-string">order_date</span> <span class="cite">[cite: 731]</span>
    [cite_start]<span class="yaml-key">time_grains:</span> [<span class="yaml-string">day</span>, <span class="yaml-string">week</span>, <span class="yaml-string">month</span>, <span class="yaml-string">quarter</span>, <span class="yaml-string">year</span>] <span class="cite">[cite: 732]</span>
    [cite_start]<span class="yaml-key">filters:</span> <span class="cite">[cite: 733]</span>
      - [cite_start]<span class="yaml-key">field:</span> <span class="yaml-string">order_status</span> <span class="cite">[cite: 734]</span>
        [cite_start]<span class="yaml-key">operator:</span> <span class="yaml-string">'='</span> <span class="cite">[cite: 735]</span>
        [cite_start]<span class="yaml-key">value:</span> <span class="yaml-string">'completed'</span> <span class="cite">[cite: 736]</span>
    [cite_start]<span class="yaml-key">dimensions:</span> <span class="cite">[cite: 737]</span>
      - [cite_start]<span class="yaml-string">customer_id</span> <span class="cite">[cite: 738]</span>
      - [cite_start]<span class="yaml-string">order_date</span> <span class="cite">[cite: 739]</span>

  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">average_order_value</span> <span class="cite">[cite: 740]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"The average 'order_total_amount' for completed orders."</span> <span class="cite">[cite: 741]</span>
    [cite_start]<span class="yaml-key">model:</span> <span class="yaml-string">ref('fact_orders')</span> <span class="cite">[cite: 742]</span>
    [cite_start]<span class="yaml-key">calculation_method:</span> <span class="yaml-string">average</span> <span class="cite">[cite: 743]</span>
    [cite_start]<span class="yaml-key">expression:</span> <span class="yaml-string">order_total_amount</span> <span class="cite">[cite: 744]</span>
    [cite_start]<span class="yaml-key">timestamp:</span> <span class="yaml-string">order_date</span> <span class="cite">[cite: 745]</span>
    [cite_start]<span class="yaml-key">time_grains:</span> [<span class="yaml-string">day</span>, <span class="yaml-string">week</span>, <span class="yaml-string">month</span>] <span class="cite">[cite: 746]</span>
    <span class="yaml-key">filters:</span>
      - [cite_start]{<span class="yaml-key">field:</span> order_status, <span class="yaml-key">operator:</span> '=', <span class="yaml-key">value:</span> 'completed'} <span class="cite">[cite: 747, 748, 749]</span>
    <span class="yaml-key">dimensions:</span>
      - [cite_start]<span class="yaml-string">customer_id</span> <span class="cite">[cite: 751]</span>

  - [cite_start]<span class="yaml-key">name:</span> <span class="yaml-string">active_customers</span> <span class="cite">[cite: 752]</span>
    [cite_start]<span class="yaml-key">description:</span> <span class="yaml-string">"Count of unique customers with at least one completed order..."</span> <span class="cite">[cite: 753]</span>
    [cite_start]<span class="yaml-key">model:</span> <span class="yaml-string">ref('fact_orders')</span> <span class="cite">[cite: 754]</span>
    [cite_start]<span class="yaml-key">calculation_method:</span> <span class="yaml-string">count_distinct</span> <span class="cite">[cite: 755]</span>
    [cite_start]<span class="yaml-key">expression:</span> <span class="yaml-string">customer_id</span> <span class="cite">[cite: 756]</span>
    [cite_start]<span class="yaml-key">timestamp:</span> <span class="yaml-string">order_date</span> <span class="cite">[cite: 757]</span>
    [cite_start]<span class="yaml-key">time_grains:</span> [<span class="yaml-string">day</span>, <span class="yaml-string">week</span>, <span class="yaml-string">month</span>, <span class="yaml-string">quarter</span>, <span class="yaml-string">year</span>] <span class="cite">[cite: 758]</span>
    <span class="yaml-key">filters:</span>
      - [cite_start]{<span class="yaml-key">field:</span> order_status, <span class="yaml-key">operator:</span> '=', <span class="yaml-key">value:</span> 'completed'} <span class="cite">[cite: 759, 760, 761, 762]</span>
</code></pre></div>
                                        <div class="explanation">
                                            <p>Defines three key business metrics: <code>total_revenue</code>, <code>average_order_value</code>, and <code>active_customers</code>. [cite_start]<span class="cite">[cite: 764]</span> Each metric specifies its underlying model, calculation method, column, timestamp, filters, and dimensions. [cite_start]<span class="cite">[cite: 765]</span> These are foundational for the dbt Semantic Layer and will also appear in dbt Docs. [cite_start]<span class="cite">[cite: 766]</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div> </div>
        </div>
    </div>

    <footer class="text-center p-4" style="background-color: #f1f1f1;">
        <div class="container">
            <p class="text-muted mb-0">dbt Final Project Lab Guide | Generated from PDF</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>