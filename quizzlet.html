<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz powered by Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Indigo & Amber -->
    <!-- Application Structure Plan: A multi-screen SPA managed within a single page. The flow is: 1. Setup Screen (user enters topic/questions). 2. Quiz Screen (one question at a time, with progress tracking). 3. Results Screen (detailed analysis, score, and share/download options). This structure was chosen to create a focused, step-by-step user experience, preventing distractions during the quiz and providing a comprehensive summary afterward. State is managed via JS objects. -->
    <!-- Visualization & Content Choices: 1. Quiz Generation -> Goal: Dynamic Content -> Method: Gemini API call -> Interaction: User input for topic -> Justification: Creates a unique quiz every time. 2. Progress -> Goal: Inform -> Presentation: HTML/CSS progress bar & text counters -> Interaction: Dynamic updates via JS -> Justification: Provides clear, real-time feedback. 3. Results -> Goal: Analyze -> Presentation: Chart.js Doughnut Chart for score, HTML for detailed breakdown -> Interaction: Static view -> Justification: The doughnut chart offers an immediate visual summary of performance. 4. Share/Download -> Goal: Usability -> Presentation: Buttons -> Interaction: Click to trigger `mailto:` or file download -> Justification: Provides standard, functional ways for users to save their results. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover {
            transform: scale(1.02);
            background-color: #f0f9ff; /* sky-50 */
        }
        .quiz-option.selected {
            background-color: #e0e7ff; /* indigo-100 */
            border-color: #4f46e5; /* indigo-600 */
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4f46e5; /* indigo-600 */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result-correct {
             background-color: #f0fdf4; border-left: 4px solid #22c55e;
        }
        .result-incorrect {
            background-color: #fef2f2; border-left: 4px solid #ef4444;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">

    <header class="bg-indigo-800 text-white shadow-md">
        <div class="container mx-auto p-4 text-center">
            <h2 class="text-xl font-bold">Learn with Vikash in association with Vedadots</h2>
        </div>
    </header>

    <main id="app-container" class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Screen 1: Setup -->
        <div id="setup-screen">
            <div class="bg-white p-8 rounded-xl shadow-lg text-center">
                <h1 class="text-4xl font-bold text-slate-900">Create Your Quiz</h1>
                <p class="text-slate-600 mt-4 text-lg">Enter any topic, and Gemini will generate a quiz for you instantly.</p>
                <div class="mt-8">
                    <input type="text" id="topic-input" class="w-full max-w-md p-3 border border-slate-300 rounded-lg text-center text-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="e.g., 'dbt fundamentals' or 'World Capitals'">
                    <div class="mt-4">
                        <label for="num-questions" class="text-slate-600">Number of Questions:</label>
                        <select id="num-questions" class="p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="15">15</option>
                        </select>
                    </div>
                    <button id="start-quiz-btn" class="mt-8 w-full max-w-md bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-lg hover:bg-indigo-700 transition-transform transform hover:scale-105">Start Quiz</button>
                </div>
            </div>
        </div>

        <!-- Screen 2: Quiz -->
        <div id="quiz-screen" class="hidden">
            <div id="quiz-loader" class="text-center p-8">
                <div class="loader mx-auto"></div>
                <p class="mt-4 text-lg text-slate-600">Generating your quiz...</p>
            </div>
            <div id="quiz-content" class="hidden">
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <div id="progress-text" class="text-slate-600">Question 1 of 10</div>
                        <div id="timer" class="text-slate-600 font-semibold">Time: 00:00</div>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-2.5 mb-6">
                        <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 10%"></div>
                    </div>

                    <h2 id="question-text" class="text-2xl font-bold mb-6 text-slate-900 min-h-[100px]"></h2>
                    <div id="options-container" class="space-y-4"></div>

                    <div class="mt-8 text-right">
                        <button id="next-question-btn" class="bg-indigo-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-indigo-700 transition disabled:bg-slate-400 disabled:cursor-not-allowed">Next</button>
                        <button id="submit-quiz-btn" class="hidden bg-amber-500 text-white font-bold py-2 px-8 rounded-lg hover:bg-amber-600 transition">Submit</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 3: Results -->
        <div id="results-screen" class="hidden">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h1 class="text-4xl font-bold text-slate-900 text-center">Quiz Results</h1>
                <div class="text-center text-slate-600 mt-2">Topic: <span id="results-topic" class="font-semibold"></span></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center mt-8">
                    <div class="chart-container h-64 w-64 mx-auto">
                        <canvas id="results-chart"></canvas>
                    </div>
                    <div class="text-center md:text-left">
                        <div class="text-2xl font-bold">Your Score</div>
                        <div id="score-text" class="text-6xl font-bold text-indigo-600 my-2"></div>
                        <div id="summary-text" class="text-lg text-slate-600"></div>
                        <div class="mt-6 flex justify-center md:justify-start space-x-4">
                            <button id="share-btn" class="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-indigo-700 transition">Share Results</button>
                            <button id="download-btn" class="bg-slate-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-slate-700 transition">Download Report</button>
                        </div>
                    </div>
                </div>

                <div class="mt-12">
                    <h2 class="text-2xl font-bold border-b pb-2 mb-4">Detailed Analysis</h2>
                    <div id="detailed-results" class="space-y-4"></div>
                </div>
                 <div class="mt-8 text-center">
                    <button id="restart-quiz-btn" class="bg-indigo-100 text-indigo-700 font-bold py-3 px-8 rounded-lg hover:bg-indigo-200 transition">Take Another Quiz</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-indigo-800 text-slate-300 mt-16">
        <div class="container mx-auto p-8 text-center">
            <p class="font-semibold">Expert guided trainings on Cloud Data Platforms & GenAI</p>
            <p class="mt-2">Contact us: <a href="mailto:info@vedadots.com" class="text-indigo-300 hover:underline">info@vedadots.com</a></p>
        </div>
    </footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- State Management ---
    let quizState = {
        questions: [],
        currentQuestionIndex: 0,
        userAnswers: [],
        timerInterval: null,
        secondsElapsed: 0,
        topic: ''
    };

    // --- DOM Elements ---
    const setupScreen = document.getElementById('setup-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultsScreen = document.getElementById('results-screen');
    const startQuizBtn = document.getElementById('start-quiz-btn');
    const topicInput = document.getElementById('topic-input');
    const numQuestionsSelect = document.getElementById('num-questions');
    const quizLoader = document.getElementById('quiz-loader');
    const quizContent = document.getElementById('quiz-content');
    
    // --- Gemini API Call Function ---
    const API_KEY = ""; 
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
    
    async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "OBJECT",
                    properties: {
                        "questions": {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "questionText": { "type": "STRING" },
                                    "options": { "type": "ARRAY", "items": { "type": "STRING" } },
                                    "correctAnswerIndex": { "type": "NUMBER" }
                                },
                                required: ["questionText", "options", "correctAnswerIndex"]
                            }
                        }
                    }
                }
            }
        };

        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate?.content?.parts?.[0]?.text) {
                    return JSON.parse(candidate.content.parts[0].text);
                }
                throw new Error('Invalid response structure');
            } catch (error) {
                console.error(`Attempt ${i+1} failed:`, error);
                if (i === retries - 1) {
                    alert("Failed to generate quiz. Please check the topic or try again later.");
                    return null;
                }
                await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
            }
        }
    }

    // --- Quiz Logic ---
    startQuizBtn.addEventListener('click', async () => {
        const topic = topicInput.value.trim();
        const numQuestions = numQuestionsSelect.value;
        if (!topic) {
            alert("Please enter a topic.");
            return;
        }

        quizState.topic = topic;
        setupScreen.classList.add('hidden');
        quizScreen.classList.remove('hidden');
        quizLoader.classList.remove('hidden');
        quizContent.classList.add('hidden');

        const prompt = `Generate a quiz with ${numQuestions} multiple-choice questions on the topic "${topic}". Each question must have exactly 4 options. Ensure the correct answer index is valid (0-3).`;
        const quizData = await callGeminiAPI(prompt);
        
        if (quizData && quizData.questions) {
            quizState.questions = quizData.questions;
            quizState.userAnswers = new Array(quizState.questions.length).fill(null);
            startQuiz();
        } else {
            // If API fails, reset to setup
            setupScreen.classList.remove('hidden');
            quizScreen.classList.add('hidden');
        }
    });

    function startQuiz() {
        quizState.currentQuestionIndex = 0;
        quizState.secondsElapsed = 0;
        quizLoader.classList.add('hidden');
        quizContent.classList.remove('hidden');
        displayQuestion();
        startTimer();
    }
    
    function displayQuestion() {
        const question = quizState.questions[quizState.currentQuestionIndex];
        document.getElementById('question-text').textContent = question.questionText;

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';
        question.options.forEach((option, index) => {
            const optionElement = document.createElement('div');
            optionElement.className = 'quiz-option p-4 border-2 border-slate-300 rounded-lg cursor-pointer';
            optionElement.textContent = option;
            optionElement.dataset.index = index;
            optionElement.addEventListener('click', () => selectOption(index, optionElement));
            optionsContainer.appendChild(optionElement);
        });

        updateProgress();
        document.getElementById('next-question-btn').disabled = true;
    }

    function selectOption(index, element) {
        document.querySelectorAll('.quiz-option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        quizState.userAnswers[quizState.currentQuestionIndex] = index;
        document.getElementById('next-question-btn').disabled = false;
    }
    
    document.getElementById('next-question-btn').addEventListener('click', () => {
        if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
            quizState.currentQuestionIndex++;
            displayQuestion();
        }
    });
    
    function updateProgress() {
        const index = quizState.currentQuestionIndex;
        const total = quizState.questions.length;
        document.getElementById('progress-text').textContent = `Question ${index + 1} of ${total}`;
        document.getElementById('progress-bar').style.width = `${((index + 1) / total) * 100}%`;

        if (index === total - 1) {
            document.getElementById('next-question-btn').classList.add('hidden');
            document.getElementById('submit-quiz-btn').classList.remove('hidden');
        } else {
             document.getElementById('next-question-btn').classList.remove('hidden');
            document.getElementById('submit-quiz-btn').classList.add('hidden');
        }
    }

    // --- Timer Logic ---
    function startTimer() {
        const timerEl = document.getElementById('timer');
        quizState.timerInterval = setInterval(() => {
            quizState.secondsElapsed++;
            const minutes = Math.floor(quizState.secondsElapsed / 60).toString().padStart(2, '0');
            const seconds = (quizState.secondsElapsed % 60).toString().padStart(2, '0');
            timerEl.textContent = `Time: ${minutes}:${seconds}`;
        }, 1000);
    }
    
    // --- Results Logic ---
    document.getElementById('submit-quiz-btn').addEventListener('click', () => {
        clearInterval(quizState.timerInterval);
        quizScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');
        displayResults();
    });

    function displayResults() {
        let correctAnswers = 0;
        quizState.questions.forEach((q, i) => {
            if (q.correctAnswerIndex === quizState.userAnswers[i]) {
                correctAnswers++;
            }
        });

        const score = (correctAnswers / quizState.questions.length) * 100;
        document.getElementById('results-topic').textContent = quizState.topic;
        document.getElementById('score-text').textContent = `${score.toFixed(0)}%`;
        document.getElementById('summary-text').textContent = `You answered ${correctAnswers} out of ${quizState.questions.length} questions correctly.`;

        // Chart
        const ctx = document.getElementById('results-chart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Correct', 'Incorrect'],
                datasets: [{
                    data: [correctAnswers, quizState.questions.length - correctAnswers],
                    backgroundColor: ['#22c55e', '#ef4444'],
                    borderColor: ['#ffffff'],
                    borderWidth: 4,
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } }
        });

        // Detailed Breakdown
        const detailsContainer = document.getElementById('detailed-results');
        detailsContainer.innerHTML = '';
        quizState.questions.forEach((q, i) => {
            const isCorrect = q.correctAnswerIndex === quizState.userAnswers[i];
            const resultClass = isCorrect ? 'result-correct' : 'result-incorrect';
            const userAnswerText = quizState.userAnswers[i] !== null ? q.options[quizState.userAnswers[i]] : "Not Answered";
            
            const resultEl = document.createElement('div');
            resultEl.className = `p-4 rounded-lg ${resultClass}`;
            resultEl.innerHTML = `
                <p class="font-bold">${i + 1}. ${q.questionText}</p>
                <p class="mt-2">Your answer: <span class="font-semibold">${userAnswerText}</span> ${isCorrect ? '✅' : '❌'}</p>
                ${!isCorrect ? `<p>Correct answer: <span class="font-semibold">${q.options[q.correctAnswerIndex]}</span></p>` : ''}
            `;
            detailsContainer.appendChild(resultEl);
        });
    }

    // --- Share/Download/Restart ---
    document.getElementById('share-btn').addEventListener('click', () => {
        const score = document.getElementById('score-text').textContent;
        const subject = `I scored ${score} on my ${quizState.topic} quiz!`;
        const body = `I took a quiz on "${quizState.topic}" and scored ${score}. Check out this cool interactive quiz generator!`;
        window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    });

    document.getElementById('download-btn').addEventListener('click', () => {
        let report = `Quiz Report\nTopic: ${quizState.topic}\n`;
        report += `Final Score: ${document.getElementById('score-text').textContent}\n`;
        report += `Summary: ${document.getElementById('summary-text').textContent}\n\n`;
        report += "------ Detailed Analysis ------\n\n";

        quizState.questions.forEach((q, i) => {
            const isCorrect = q.correctAnswerIndex === quizState.userAnswers[i];
            const userAnswerText = quizState.userAnswers[i] !== null ? q.options[quizState.userAnswers[i]] : "Not Answered";
            report += `${i + 1}. ${q.questionText}\n`;
            report += `   Your answer: ${userAnswerText} (${isCorrect ? 'Correct' : 'Incorrect'})\n`;
            if(!isCorrect) {
                report += `   Correct answer: ${q.options[q.correctAnswerIndex]}\n`;
            }
            report += '\n';
        });

        const blob = new Blob([report], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'quiz-report.txt';
        link.click();
    });

    document.getElementById('restart-quiz-btn').addEventListener('click', () => {
        // Reset state
        quizState = { questions: [], currentQuestionIndex: 0, userAnswers: [], timerInterval: null, secondsElapsed: 0, topic: '' };
        topicInput.value = '';
        resultsScreen.classList.add('hidden');
        setupScreen.classList.remove('hidden');
    });
});
</script>

</body>
</html>
