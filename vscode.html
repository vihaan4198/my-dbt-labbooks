<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive dbt Lab Guide: Mastering Configurations & Constraints</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Slate & Amber -->
    <!-- Application Structure Plan: A vertically scrolling, single-page application segmented into logical parts (Setup, Configuration, Constraints, Summary). This structure guides the user through the lab linearly, like the source document, but enhances each step with interactivity. Key interactions include code-copying, a tabbed interface to compare configuration files, and an interactive schema diagram to explore and simulate dbt tests, making abstract concepts tangible and improving knowledge retention over a static document. -->
    <!-- Visualization & Content Choices: 1. Source Data -> Goal: Inform -> Chart.js Bar Chart -> Interaction: Hover for details -> Justification: Provides an immediate visual overview of the initial dataset. 2. Configuration Files -> Goal: Compare -> Tabbed HTML/CSS view -> Interaction: Click tabs to switch file content -> Justification: Directly contrasts project-level vs. property-level YAML files. 3. Constraints -> Goal: Organize/Test -> Interactive HTML Schema Diagram -> Interaction: Click column to see tests/constraints & simulate a 'dbt test' run -> Justification: Connects YAML definitions to the database schema visually and provides instant feedback. 4. Code Blocks -> Goal: Usability -> HTML <pre><code> with a 'Copy' button -> Interaction: Click to copy -> Justification: Improves the hands-on lab experience. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 9999px;
            background-color: #1e293b;
            color: #ffffff;
            font-weight: bold;
            flex-shrink: 0;
        }
        .code-block {
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .code-block:hover .copy-btn {
            opacity: 1;
        }
        .config-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        .config-tab.active {
            border-bottom-color: #f59e0b;
            color: #f59e0b;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f59e0b;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        
        <header class="text-center my-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">dbt Lab Guide</h1>
            <p class="text-xl text-slate-600 mt-2">Mastering Configurations & Constraints with AI</p>
        </header>

        <!-- Part 1: Setup -->
        <section class="mb-12">
            <div class="flex items-center mb-4">
                <div class="step-indicator">1</div>
                <h2 class="text-2xl font-bold ml-4 text-slate-800">Lab Setup: Preparing Snowflake</h2>
            </div>
            <p class="mb-6">First, we need to create our source tables in Snowflake and populate them with sample data. This simulates the raw data your dbt project will read from. The chart below gives a quick overview of our initial product data.</p>
            
            <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 mb-8">
                <h3 class="text-lg font-semibold text-center mb-4 text-slate-800">Initial Product Categories</h3>
                <div class="chart-container">
                    <canvas id="initialDataChart"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-lg mb-2">Table DDL</h3>
                    <div class="code-block bg-slate-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                        <button class="copy-btn" data-code-id="ddl-code">Copy</button>
                        <pre><code id="ddl-code" class="language-sql">-- Use a role that has permissions to create objects
USE ROLE SYSADMIN;

-- Create a database and schema for our raw data
CREATE DATABASE IF NOT EXISTS ESHOPALOT_RAW;
CREATE SCHEMA IF NOT EXISTS ESHOPALOT_RAW.RAW_DATA;

-- Create our source tables
CREATE OR REPLACE TABLE ESHOPALOT_RAW.RAW_DATA.PRODUCTS (
    PRODUCT_ID NUMBER,
    NAME VARCHAR,
    PRICE NUMBER(10, 2),
    CATEGORY VARCHAR,
    SUPPLIER_ID NUMBER,
    CREATED_AT TIMESTAMP_NTZ
);

CREATE OR REPLACE TABLE ESHOPALOT_RAW.RAW_DATA.SUPPLIERS (
    SUPPLIER_ID NUMBER,
    SUPPLIER_NAME VARCHAR,
    COUNTRY VARCHAR
);</code></pre>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-2">Insert Statements</h3>
                    <div class="code-block bg-slate-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                        <button class="copy-btn" data-code-id="dml-code">Copy</button>
                        <pre><code id="dml-code" class="language-sql">-- Insert data into PRODUCTS table
INSERT INTO ESHOPALOT_RAW.RAW_DATA.PRODUCTS (PRODUCT_ID, NAME, PRICE, CATEGORY, SUPPLIER_ID, CREATED_AT) VALUES
(101, 'Wireless Pro Mouse', 79.99, 'Electronics', 1, '2025-10-15 09:00:00'),
(102, 'Gaming Keyboard', 129.50, 'Electronics', 1, '2025-10-15 09:05:00'),
(103, 'Organic Coffee Beans', 22.00, 'Groceries', 2, '2025-10-15 09:10:00'),
(104, 'Yoga Mat', 45.00, 'Fitness', 3, '2025-10-15 09:15:00'),
(105, 'Bluetooth Speaker', 99.99, NULL, 1, '2025-10-15 09:20:00');

-- Insert data into SUPPLIERS table
INSERT INTO ESHOPALOT_RAW.RAW_DATA.SUPPLIERS (SUPPLIER_ID, SUPPLIER_NAME, COUNTRY) VALUES
(1, 'TechGlobal Inc.', 'USA'),
(2, 'FarmFresh Goods', 'Canada'),
(3, 'FitLife Co.', 'USA');</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Part 2: Configuration -->
        <section class="mb-12">
            <div class="flex items-center mb-4">
                <div class="step-indicator">2</div>
                <h2 class="text-2xl font-bold ml-4 text-slate-800">Configuration Deep Dive</h2>
            </div>
            <p class="mb-6">dbt uses YAML files to manage project configurations. The key is knowing *where* to define different settings. Use `dbt_project.yml` for broad rules, and specific `.yml` files for granular details. Use the tabs below to explore, and click the ✨ button to get an AI-powered explanation for each file.</p>

            <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                <div class="border-b border-slate-200 mb-4">
                    <nav class="flex -mb-px">
                        <button class="config-tab active" data-target="project-config">dbt_project.yml</button>
                        <button class="config-tab" data-target="sources-config">sources.yml</button>
                        <button class="config-tab" data-target="marts-config">models/marts/marts.yml</button>
                    </nav>
                </div>
                <div id="config-content">
                    <!-- Content will be injected by JS -->
                </div>
            </div>
        </section>
        
        <!-- Part 3: Constraints -->
        <section class="mb-12">
             <div class="flex items-center mb-4">
                <div class="step-indicator">3</div>
                <h2 class="text-2xl font-bold ml-4 text-slate-800">Constraint Explorer</h2>
            </div>
            <p class="mb-6">Constraints ensure data integrity. dbt applies these as **logical tests** and **physical constraints**. Click on the columns of the `dim_products` table below to inspect its tests, then use the ✨ AI assistant to suggest more tests based on the column's properties.</p>

            <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-semibold text-lg text-center mb-4">`dim_products` Schema</h3>
                        <div class="space-y-2" id="schema-diagram">
                            <!-- Columns will be injected by JS -->
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 min-h-[300px]">
                        <h3 class="font-semibold text-lg mb-2">Details & Test Simulation</h3>
                        <div id="constraint-details">
                            <p class="text-slate-500">Select a column to see its configuration.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Summary -->
        <section>
            <div class="flex items-center mb-4">
                <div class="step-indicator">4</div>
                <h2 class="text-2xl font-bold ml-4 text-slate-800">Summary: Where to Configure</h2>
            </div>
            <p class="mb-6">By following this pattern, you create a dbt project that is easy to navigate, well-documented, and robust. Broad rules are defined centrally, while specific details and documentation live right alongside the models they describe.</p>
            <div class="overflow-x-auto bg-white p-4 rounded-lg shadow-md border border-slate-200">
                <table class="w-full text-left">
                    <thead class="bg-slate-100">
                        <tr>
                            <th class="p-3 font-semibold">Use Case</th>
                            <th class="p-3 font-semibold">Best Method</th>
                            <th class="p-3 font-semibold">Why?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-slate-200">
                            <td class="p-3 align-top"><strong>Set all models in a folder to be tables</strong></td>
                            <td class="p-3 align-top"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded-full text-sm">dbt_project.yml</span></td>
                            <td class="p-3 align-top">Broad, directory-level rule. Keeps configuration DRY (Don't Repeat Yourself).</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="p-3 align-top"><strong>Add a description to a specific model</strong></td>
                            <td class="p-3 align-top"><span class="bg-sky-100 text-sky-800 px-2 py-1 rounded-full text-sm">Property .yml file</span></td>
                            <td class="p-3 align-top">Granular detail specific to one model. Separates documentation from code.</td>
                        </tr>
                        <tr class="border-b border-slate-200">
                            <td class="p-3 align-top"><strong>Add a `not_null` test to a primary key</strong></td>
                            <td class="p-3 align-top"><span class="bg-sky-100 text-sky-800 px-2 py-1 rounded-full text-sm">Property .yml file</span></td>
                            <td class="p-3 align-top">Defines a specific data quality check for one column.</td>
                        </tr>
                         <tr class="border-b border-slate-200">
                            <td class="p-3 align-top"><strong>Change the default schema for your project</strong></td>
                            <td class="p-3 align-top"><span class="bg-amber-100 text-amber-800 px-2 py-1 rounded-full text-sm">dbt_project.yml</span></td>
                            <td class="p-3 align-top">A project-wide setting that defines the overall structure.</td>
                        </tr>
                         <tr>
                            <td class="p-3 align-top"><strong>Enforce a `NOT NULL` physical constraint</strong></td>
                            <td class="p-3 align-top"><span class="bg-sky-100 text-sky-800 px-2 py-1 rounded-full text-sm">Property .yml file</span></td>
                            <td class="p-3 align-top">A specific, column-level rule about the physical structure of the table.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    // --- Gemini API Call Function ---
    const API_KEY = "";
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
    
    async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
        };

        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    return candidate.content.parts[0].text;
                } else {
                     throw new Error('Invalid response structure from Gemini API');
                }
            } catch (error) {
                if (i === retries - 1) {
                    console.error('Gemini API call failed after all retries:', error);
                    return "Sorry, the AI assistant is currently unavailable. Please try again later.";
                }
                await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
            }
        }
    }


    // Part 1: Initial Data Chart
    const initialRawData = [
        { category: 'Electronics', count: 2 },
        { category: 'Groceries', count: 1 },
        { category: 'Fitness', count: 1 },
        { category: 'Unknown', count: 1 }
    ];
    const ctx = document.getElementById('initialDataChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: initialRawData.map(d => d.category),
            datasets: [{
                label: '# of Products',
                data: initialRawData.map(d => d.count),
                backgroundColor: [
                    'rgba(59, 130, 246, 0.5)',
                    'rgba(16, 185, 129, 0.5)',
                    'rgba(245, 158, 11, 0.5)',
                    'rgba(107, 114, 128, 0.5)'
                ],
                borderColor: [
                    'rgba(59, 130, 246, 1)',
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                    'rgba(107, 114, 128, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
            plugins: { legend: { display: false } }
        }
    });

    // Copy to clipboard functionality
    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', () => {
            const codeId = button.dataset.codeId;
            const codeElement = document.getElementById(codeId);
            navigator.clipboard.writeText(codeElement.innerText).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => { button.textContent = 'Copy'; }, 2000);
            });
        });
    });

    // Part 2: Configuration Tabs
    const configTabs = document.querySelectorAll('.config-tab');
    const configContentEl = document.getElementById('config-content');

    const configData = {
        'project-config': {
            title: 'Project-wide Rules (`dbt_project.yml`)',
            description: 'This file sets broad configurations for directories. Here, we set all models in the `staging` folder to be views and all models in the `marts` folder to be tables.',
            code: `name: 'eshopalot'

models:
  eshopalot:
    staging:
      +materialized: view
    marts:
      +materialized: table`
        },
        'sources-config': {
            title: 'Source Definitions (`sources.yml`)',
            description: 'This file tells dbt where to find your raw data, allowing you to use the `source()` function and test your source data quality.',
            code: `version: 2

sources:
  - name: raw_data
    database: eshopalot_raw
    schema: raw_data
    tables:
      - name: products
      - name: suppliers`
        },
        'marts-config': {
            title: 'Model Properties (`models/marts/marts.yml`)',
            description: 'This file defines granular properties for a specific model, including its description, column descriptions, and data quality tests.',
            code: `version: 2

models:
  - name: dim_products
    description: "A dimension table containing product information joined with supplier details."
    columns:
      - name: product_id
        description: "The unique identifier for a product."
        tests:
          - unique
          - not_null`
        }
    };
    
    function renderConfigContent(target) {
        const content = configData[target];
        configContentEl.innerHTML = `
            <h3 class="font-semibold text-lg text-slate-800 mb-2">${content.title}</h3>
            <p class="text-slate-600 mb-4">${content.description}</p>
            <div class="code-block bg-slate-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                <pre><code class="language-yaml">${content.code}</code></pre>
            </div>
            <div class="mt-4">
                 <button class="explain-config-btn w-full md:w-auto bg-amber-500 text-white py-2 px-4 rounded-md hover:bg-amber-600 transition">✨ Explain This Config</button>
            </div>
            <div class="ai-explanation-container mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg hidden"></div>
        `;
        configContentEl.querySelector('.explain-config-btn').addEventListener('click', handleExplainConfig);
    }
    
    async function handleExplainConfig(event) {
        const button = event.target;
        const container = button.parentElement.nextElementSibling;
        const activeTab = document.querySelector('.config-tab.active').dataset.target;
        const fileContent = configData[activeTab].code;

        container.classList.remove('hidden');
        container.innerHTML = '<div class="loader"></div>';
        button.disabled = true;

        const prompt = `Act as a dbt expert. Explain the following dbt configuration file in simple terms for a data engineer who is learning. Explain what each section does and why it's important. Format your response as simple HTML paragraphs. Here is the file content:\n\n${fileContent}`;
        
        const explanation = await callGeminiAPI(prompt);
        container.innerHTML = explanation.replace(/\n/g, '<br>'); // Simple formatting
        button.disabled = false;
    }

    configTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            configTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            renderConfigContent(tab.dataset.target);
        });
    });

    renderConfigContent('project-config');

    // Part 3: Constraint Explorer
    const schemaDiagramEl = document.getElementById('schema-diagram');
    const constraintDetailsEl = document.getElementById('constraint-details');

    const schemaData = {
        'product_id': {
            type: 'NUMBER',
            tests: [
                { name: 'unique', type: 'logical', pass: true },
                { name: 'not_null', type: 'logical', pass: true }
            ],
            constraints: [{ type: 'not_null', enforced: true }],
            yaml: `- name: product_id
  description: "The unique identifier for a product."
  constraints:
    - type: not_null
  tests:
    - unique
    - not_null`
        },
        'name': { type: 'VARCHAR', tests: [], constraints: [], yaml: '- name: name\n  description: "The name of the product."' },
        'price': { type: 'NUMBER(10,2)', tests: [], constraints: [], yaml: '- name: price\n  description: "The retail price of the product."' },
        'category': {
            type: 'VARCHAR',
            tests: [{ name: 'accepted_values', values: "['Electronics', 'Groceries', 'Fitness']", type: 'logical', pass: true, note: 'Test passes because `null` is an accepted value by default.' }],
            constraints: [],
            yaml: `- name: category
  description: "The product category. Can be null."
  tests:
    - accepted_values:
        values: ['Electronics', 'Groceries', 'Fitness']`
        },
        'supplier_name': {
            type: 'VARCHAR',
            tests: [{ name: 'relationships', to: "ref('stg_suppliers')", field: 'supplier_name', type: 'logical', pass: true }],
            constraints: [],
            yaml: `- name: supplier_name
  description: "The name of the supplier for the product."
  tests:
    - relationships:
        to: ref('stg_suppliers')
        field: supplier_name`
        }
    };

    Object.keys(schemaData).forEach(col => {
        const colData = schemaData[col];
        const hasTests = colData.tests.length > 0 || colData.constraints.length > 0;
        schemaDiagramEl.innerHTML += `
            <div class="flex items-center justify-between p-3 border rounded-md cursor-pointer hover:bg-slate-100 transition schema-column" data-column="${col}">
                <div>
                    <span class="font-mono font-semibold">${col}</span>
                    <span class="text-sm text-slate-500 ml-2">${colData.type}</span>
                </div>
                ${hasTests ? '<span class="text-xs bg-amber-200 text-amber-800 font-bold px-2 py-1 rounded-full">TESTS</span>' : ''}
            </div>
        `;
    });

    function renderConstraintDetails(columnName) {
        const colData = schemaData[columnName];
        let testsHtml = colData.tests.map(t => `
            <div class="flex items-center mb-2">
                <span class="text-sm font-mono bg-slate-200 text-slate-700 px-2 py-1 rounded">${t.name}</span>
                <span class="ml-auto text-sm font-semibold ${t.pass ? 'text-green-600' : 'text-red-600'}">
                    ${t.pass ? '✅ PASS' : '❌ FAIL'}
                </span>
            </div>
            ${t.note ? `<p class="text-xs text-slate-500 italic -mt-1 mb-2">${t.note}</p>` : ''}
        `).join('');
        
        let constraintsHtml = colData.constraints.map(c => `
             <div class="flex items-center mb-2">
                <span class="text-sm font-mono bg-blue-200 text-blue-800 px-2 py-1 rounded">${c.type}</span>
                <span class="ml-auto text-sm font-semibold text-blue-700">
                    ${c.enforced ? 'PHYSICAL (ENFORCED)' : 'PHYSICAL (METADATA)'}
                </span>
            </div>
        `).join('');

        constraintDetailsEl.innerHTML = `
            <h4 class="font-bold text-lg mb-4 font-mono">${columnName}</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mb-4">
                <button id="simulate-test-btn" class="w-full bg-slate-600 text-white py-2 px-3 rounded-md hover:bg-slate-700 transition text-sm">Simulate 'dbt test'</button>
                <button id="suggest-tests-btn" class="w-full bg-amber-500 text-white py-2 px-3 rounded-md hover:bg-amber-600 transition text-sm">✨ Suggest dbt Tests</button>
            </div>
            <div id="test-results" class="hidden p-3 bg-white rounded-md mb-4">
                 <h5 class="font-semibold mb-2">Test Results:</h5>
                 ${testsHtml || '<p class="text-sm text-slate-500">No logical tests defined.</p>'}
                 <h5 class="font-semibold mt-4 mb-2">Physical Constraints:</h5>
                 ${constraintsHtml || '<p class="text-sm text-slate-500">No physical constraints defined.</p>'}
            </div>
            <div id="ai-suggestions-container" class="hidden"></div>
            <h5 class="font-semibold mt-4 mb-2 text-slate-600">YAML Configuration:</h5>
            <div class="code-block bg-slate-800 text-white p-3 rounded-md text-xs overflow-x-auto">
                <pre><code>${colData.yaml}</code></pre>
            </div>
        `;

        document.getElementById('simulate-test-btn').addEventListener('click', () => {
             document.getElementById('test-results').classList.toggle('hidden');
        });
        document.getElementById('suggest-tests-btn').addEventListener('click', () => handleSuggestTests(columnName));
    }
    
    async function handleSuggestTests(columnName) {
        const colData = schemaData[columnName];
        const container = document.getElementById('ai-suggestions-container');
        const button = document.getElementById('suggest-tests-btn');
        
        container.classList.remove('hidden');
        container.innerHTML = '<div class="loader"></div>';
        button.disabled = true;

        const prompt = `Act as a senior data engineer. For a database column named '${columnName}' with data type '${colData.type}', suggest 2-3 additional dbt tests in YAML format that would be appropriate. For example, for a price column, suggest a 'dbt_expectations.expect_column_values_to_be_between'. For a string column, suggest length checks. Provide *only* the YAML for the new tests, indented correctly under a 'tests:' key. Do not include the existing tests. Here is the existing YAML for context:\n\n${colData.yaml}`;

        const suggestions = await callGeminiAPI(prompt);
        
        container.innerHTML = `
            <h5 class="font-semibold mt-4 mb-2 text-slate-600">✨ AI Test Suggestions:</h5>
            <div class="code-block bg-slate-800 text-white p-3 rounded-md text-xs overflow-x-auto">
                <pre><code># Add these to your column's YAML configuration\n${suggestions.replace(/```yaml\n|```/g, '').trim()}</code></pre>
            </div>
        `;
        button.disabled = false;
    }

    schemaDiagramEl.addEventListener('click', (e) => {
        const columnEl = e.target.closest('.schema-column');
        if (columnEl) {
             document.querySelectorAll('.schema-column').forEach(el => el.classList.remove('bg-amber-100', 'border-amber-400'));
             columnEl.classList.add('bg-amber-100', 'border-amber-400');
            renderConstraintDetails(columnEl.dataset.column);
        }
    });

});
</script>

</body>
</html>

